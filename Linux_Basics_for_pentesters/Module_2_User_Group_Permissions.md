# **Module 2: User, Group aur File Permissions Management**

## **Topic 1: User aur Group Management**

### **1. Topic ka Naam / Ek Line Mein Summary** ğŸš€
**User aur Group Management:** Linux mein users aur groups ko create, modify, aur delete karna - system access control ki buniyaad.

### **2. Ye Kya Hai? (What is it?)**
Linux ek multi-user system hai jahan multiple users ek saath kaam kar sakte hain. User management wo process hai jisse hum users create karte hain, unhe groups mein organize karte hain, aur unki permissions control karte hain.

**Analogy:** Sochiye ek office building hai. Users wo log hain jinhe building mein entry milti hai (employees). Groups departments hain (HR, IT, Sales). Har department ke members ko alag-alag rooms (files/folders) ki access hoti hai. Building manager (root user) sabko control karta hai.

### **3. Kyun Zaroori Hai? (Why is it important?)**
**Pentester ke liye:**
- User enumeration - kaun-kaun se users hain system mein
- Weak passwords identify karna
- Group memberships check karna (privilege escalation ke liye)
- `/etc/passwd` aur `/etc/shadow` files analyze karna
- Sudo privileges check karna

**VPS Admin ke liye:**
- Team members ko access dena
- Security - har user ko sirf utni hi access jo zaroori hai
- Accountability - kaun ne kya kiya ye track karna
- Service accounts manage karna (nginx, mysql users)

### **4. Ise Kab Use Karna Chahiye? (When to use it?)**
- Naya team member join kare
- Server setup kar rahe hain
- Security audit kar rahe hain
- Pentesting mein enumeration phase
- User ko specific permissions deni hain

### **5. Agar Ye Pata Nahi Hoga Toh Kya Hoga? (If not known then what?)** ğŸ˜Ÿ
Security nightmare ho jayega - sabko root access dena padega. Pentesting mein user enumeration miss ho jayega. Multi-user environment manage nahi kar payenge. Accountability nahi rahegi ki kaun ne kya kiya.

### **6. Ye Kaise Kaam Karta Hai? / Syntax aur Options**

**Important Files:**
- `/etc/passwd` - User account information
- `/etc/shadow` - Encrypted passwords
- `/etc/group` - Group information
- `/etc/gshadow` - Encrypted group passwords

**User Management Commands:**

```bash
# User information dekhna
whoami                    # Current user
who                       # Logged in users
id                        # Current user ki UID, GID, groups
id username               # Specific user ki info

# User create karna
useradd username
useradd -m username       # Home directory ke saath
useradd -m -s /bin/bash username  # Shell specify karke

# Password set karna
passwd username

# User modify karna
usermod -aG groupname username    # Group mein add
usermod -l newname oldname        # Username change
usermod -s /bin/zsh username      # Shell change

# User delete karna
userdel username          # User delete (home directory rahega)
userdel -r username       # User + home directory delete

# User switch karna
su username               # User switch
su - username             # User switch with environment
```

**Group Management Commands:**

```bash
# Group create karna
groupadd groupname

# Group mein user add karna
usermod -aG groupname username
gpasswd -a username groupname

# Group se user remove karna
gpasswd -d username groupname

# Group delete karna
groupdel groupname

# User ke groups dekhna
groups username
```

### **7. Command Example (Poori Explanation ke Saath)**

**Scenario:** Ek naya developer "john" ko add karna hai jo "developers" group ka member hoga.

```bash
sudo useradd -m -s /bin/bash -c "John Smith" john
```

| Command Part | Matlab |
|--------------|--------|
| `sudo` | Root privileges ke saath |
| `useradd` | Naya user create karo |
| `-m` | Home directory banao (`/home/john`) |
| `-s /bin/bash` | Default shell bash set karo |
| `-c "John Smith"` | Comment/Full name |
| `john` | Username |

```bash
sudo passwd john
```
**Output:** Password prompt aayega, enter karein aur confirm karein.

```bash
sudo groupadd developers
```
**Output:** Group "developers" create ho jayega.

```bash
sudo usermod -aG developers john
```

| Command Part | Matlab |
|--------------|--------|
| `usermod` | User ko modify karo |
| `-aG` | Append to Group (existing groups ko keep karte hue) |
| `developers` | Group name |
| `john` | Username |

**Verify karna:**
```bash
id john
```
**Expected Output:** `uid=1001(john) gid=1001(john) groups=1001(john),1002(developers)`

### **8. Beginners ki Aam Galtiyan (Common Mistakes)**
- `usermod -G` use karna instead of `-aG` (existing groups remove ho jayenge)
- User create karte waqt `-m` flag bhoolna (home directory nahi banegi)
- Password set karna bhoolna (user login nahi kar payega)
- Root user ko delete karne ki koshish karna
- `/etc/passwd` ko directly edit karna instead of commands use karna

### **9. Best Practices / Pro Tips**
- **CRITICAL Fix:** Hamesha `-aG` use karein `-G` ke bajaye, warna user ke existing groups remove ho jayenge
- Production servers par users ko directly root access na dein, `sudo` use karein
- **Stealth Tip:** Pentesting mein `/etc/passwd` check karein - UID 0 wale users root equivalent hain
- Service accounts ko `/sbin/nologin` shell dein security ke liye
- `lastlog` command se dekh sakte hain kaun sa user kab login hua tha

### **10. Asli Duniya ka Scenario (Real-World Scenario)**
Ek pentester ne web server par RCE vulnerability exploit ki. Usne `cat /etc/passwd` chalaya aur dekha ki "backup" naam ka ek user hai jiska UID 0 hai (root equivalent). Usne `su backup` try kiya aur weak password guess kar liya. Boom - root access mil gaya. Agar admin ne user management properly kiya hota (unnecessary UID 0 users na hote), to ye attack fail ho jata.

### **11. Checklist / Chota Recap (TL;DR)**
- `useradd -m username` - Naya user with home directory
- `passwd username` - Password set karna
- `usermod -aG groupname username` - Group mein add
- `userdel -r username` - User delete with home
- `id username` - User ki complete info
- `/etc/passwd` - User list, `/etc/shadow` - Passwords

### **12. Aksar Puche Jaane Wale Sawaal (FAQs)**

**Q1: UID kya hai?**
A: User ID - har user ka ek unique number. Root ka UID hamesha 0 hota hai. Normal users ka 1000+ hota hai.

**Q2: `/etc/passwd` mein password kyun nahi hai?**
A: Security ke liye passwords `/etc/shadow` mein encrypted form mein store hote hain. `/etc/passwd` sabko readable hai, `/etc/shadow` sirf root ko.

**Q3: `-aG` aur `-G` mein kya fark hai?**
A: `-aG` existing groups ko keep karte hue naya group add karta hai. `-G` sirf specified groups set karta hai (baaki remove).

**Q4: User ka home directory kahan hota hai?**
A: Normal users: `/home/username`, Root user: `/root`

**Q5: Kisi user ko sudo access kaise dein?**
A: `sudo usermod -aG sudo username` (Debian/Ubuntu) ya `wheel` group (RHEL/CentOS)

### **13. Practice ke liye Task**
1. `cat /etc/passwd | wc -l` - Total users count karein
2. `sudo useradd -m testuser` - Test user banayein
3. `sudo passwd testuser` - Password set karein
4. `id testuser` - User info verify karein
5. `sudo userdel -r testuser` - User delete karein

**Expected Output:**
- 30-50 users (system users included)
- User successfully created
- Password successfully set
- UID/GID information
- User deleted with home directory

### **14. Extra / Advanced Jaankari (Optional)**
- **`/etc/skel`:** Naye users ke liye default files yahan se copy hoti hain
- **`chage`:** Password expiry policy set karne ke liye
- **`usermod -L`:** User account lock karna (temporarily disable)
- **`/etc/login.defs`:** Default user creation settings
- **Secondary Groups:** Ek user multiple groups ka member ho sakta hai

### **15. Aakhri Choti Summary (5 lines)**
- Linux multi-user system hai - proper user management zaroori hai
- `useradd`, `usermod`, `userdel` main commands hain
- `/etc/passwd` user info, `/etc/shadow` passwords store karta hai
- Groups se multiple users ko ek saath permissions di ja sakti hain
- Pentesting mein user enumeration pehla step hai

> **Ye Zaroor Yaad Rakhein**
> 1. `useradd -m` se home directory automatically ban jayegi
> 2. Hamesha `-aG` use karein group add karte waqt
> 3. Root ka UID 0 hai - koi bhi UID 0 user root equivalent hai
> 4. `/etc/shadow` sirf root read kar sakta hai
> 5. `id` command se user ki complete info milti hai

---

## **Topic 2: File Permissions ke Fundamentals**

### **1. Topic ka Naam / Ek Line Mein Summary** ğŸš€
**File Permissions Fundamentals:** Linux mein `rwx` - kaun kya kar sakta hai file/folder ke saath.

### **2. Ye Kya Hai? (What is it?)**
File permissions wo rules hain jo decide karte hain ki kaun user kya action kar sakta hai kisi file ya directory par. Teen types ke permissions hain: Read (r), Write (w), Execute (x), aur ye teen types ke users ke liye set hote hain: Owner (u), Group (g), Others (o).

**Analogy:** Sochiye ek diary hai. Read permission matlab aap diary padh sakte hain. Write permission matlab aap usme likh sakte hain. Execute permission matlab aap use ek instruction manual ki tarah use kar sakte hain. Owner wo hai jisne diary banayi, Group uske dost hain, Others baaki sab log hain.

### **3. Kyun Zaroori Hai? (Why is it important?)**
**Pentester ke liye:**
- Writable files/directories dhoondhna (privilege escalation)
- SUID/SGID binaries identify karna
- Misconfigured permissions exploit karna
- Sensitive files ki permissions check karna
- World-writable files dhoondhna

**VPS Admin ke liye:**
- Security - unauthorized access rokna
- Data protection - important files ko protect karna
- Service security - config files ko secure karna
- Compliance - security standards follow karna

### **4. Ise Kab Use Karna Chahiye? (When to use it?)**
- File/folder create karne ke baad
- Security audit kar rahe hain
- Pentesting mein enumeration phase
- Service configuration kar rahe hain
- Sensitive data store kar rahe hain

### **5. Agar Ye Pata Nahi Hoga Toh Kya Hoga? (If not known then what?)** ğŸ˜Ÿ
Security disaster - sabko sab kuch accessible ho jayega. Sensitive files (passwords, keys) leak ho sakti hain. Pentesting mein easy privilege escalation miss ho jayega. Production data accidentally delete ho sakta hai.

### **6. Ye Kaise Kaam Karta Hai? / Syntax aur Options**

**Permission Types:**
- **r (Read)** = 4
  - File: Content padh sakte hain
  - Directory: Files ki list dekh sakte hain
- **w (Write)** = 2
  - File: Content modify kar sakte hain
  - Directory: Files create/delete kar sakte hain
- **x (Execute)** = 1
  - File: Program/script run kar sakte hain
  - Directory: Directory mein enter kar sakte hain (cd)

**User Categories:**
- **u (User/Owner):** File banane wala
- **g (Group):** File ke group ke members
- **o (Others):** Baaki sab log
- **a (All):** Sabhi (u+g+o)

**Permission Format:**
```
-rwxrw-r--
â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â””â”€ Others: read only
â”‚â”‚â”‚â”‚â”‚â”‚â””â””â””â”€â”€ Group: read + write
â”‚â”‚â”‚â””â””â””â”€â”€â”€â”€â”€ User: read + write + execute
â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ File type (- = file, d = directory, l = link)
```

**Special Permissions:**
- **SUID (Set User ID):** File owner ki permission se execute (4000)
- **SGID (Set Group ID):** File group ki permission se execute (2000)
- **Sticky Bit:** Directory mein sirf owner file delete kar sakta hai (1000)

### **7. Command Example (Poori Explanation ke Saath)**

**Permissions dekhna:**
```bash
ls -l file.txt
```
**Output:** `-rw-r--r-- 1 john developers 1024 Jan 15 10:30 file.txt`

| Output Part | Matlab |
|-------------|--------|
| `-rw-r--r--` | Permissions (owner: rw, group: r, others: r) |
| `1` | Hard links count |
| `john` | Owner username |
| `developers` | Group name |
| `1024` | File size (bytes) |
| `Jan 15 10:30` | Last modified |
| `file.txt` | Filename |

**Directory permissions:**
```bash
ls -ld /tmp
```
**Output:** `drwxrwxrwt 10 root root 4096 Jan 15 10:30 /tmp`

| Permission | Matlab |
|------------|--------|
| `d` | Directory hai |
| `rwxrwxrwx` | Sabko full permissions |
| `t` | Sticky bit set hai |

**SUID binary dhoondhna:**
```bash
find / -perm -4000 -type f 2>/dev/null
```

| Command Part | Matlab |
|--------------|--------|
| `find /` | Root se search shuru karo |
| `-perm -4000` | SUID bit set wali files |
| `-type f` | Sirf files |
| `2>/dev/null` | Errors hide karo |

**Expected Output:**
```
/usr/bin/passwd
/usr/bin/sudo
/usr/bin/su
```

### **8. Beginners ki Aam Galtiyan (Common Mistakes)**
- Directory ko execute permission dena bhoolna (cd nahi kar payenge)
- `chmod 777` har jagah use karna (security risk)
- SUID aur sudo ko confuse karna
- File permissions aur ownership ko same samajhna
- Symbolic aur octal permissions ko mix karna

### **9. Best Practices / Pro Tips**
- **CRITICAL Fix:** Sensitive files (SSH keys, passwords) ko hamesha `600` ya `400` permissions dein
- **Stealth Tip:** Pentesting mein `find / -perm -2 -type f 2>/dev/null` se world-writable files dhoondhein
- Web files ko `644` (files) aur `755` (directories) permissions dein
- Scripts ko execute permission dena na bhoolein: `chmod +x script.sh`
- `umask` set karke default permissions control kar sakte hain

### **10. Asli Duniya ka Scenario (Real-World Scenario)**
Ek pentester ne web server par shell access li. Usne `find / -writable -type d 2>/dev/null` chalaya aur dekha ki `/var/www/html/uploads` directory world-writable hai. Usne wahan ek PHP web shell upload kiya aur execute kar liya. Agar admin ne proper permissions set kiye hote (755 instead of 777), to ye attack fail ho jata.

### **11. Checklist / Chota Recap (TL;DR)**
- `r` = Read (4), `w` = Write (2), `x` = Execute (1)
- Format: `rwx` (owner) `rwx` (group) `rwx` (others)
- `ls -l` se permissions dekhein
- SUID files privilege escalation ke liye useful
- Directory ko `x` permission zaroori hai `cd` karne ke liye

### **12. Aksar Puche Jaane Wale Sawaal (FAQs)**

**Q1: Directory ke liye execute permission ka kya matlab hai?**
A: Execute permission se aap directory mein enter (cd) kar sakte hain. Bina execute ke aap directory ki files access nahi kar sakte.

**Q2: SUID kya hai aur kyun dangerous hai?**
A: SUID se file hamesha owner ki permission se chalti hai. Agar root-owned SUID binary mein vulnerability hai, to attacker root ban sakta hai.

**Q3: Sticky bit kya karta hai?**
A: Sticky bit (t) se directory mein sirf file ka owner ya root hi file delete kar sakta hai. `/tmp` mein ye set hota hai.

**Q4: `chmod 777` kyun dangerous hai?**
A: Isse sabko full permissions mil jaati hain (read, write, execute). Koi bhi file modify ya delete kar sakta hai.

**Q5: File permissions aur ownership mein kya fark hai?**
A: Ownership decide karta hai file ka owner kaun hai. Permissions decide karte hain ki owner, group, others kya kar sakte hain.

### **13. Practice ke liye Task**
1. `touch testfile.txt` - File banayein
2. `ls -l testfile.txt` - Permissions dekhein
3. `mkdir testdir` - Directory banayein
4. `ls -ld testdir` - Directory permissions dekhein
5. `find /usr/bin -perm -4000 -type f 2>/dev/null | head -5` - SUID binaries dhoondhein

**Expected Output:**
- Default permissions: `-rw-r--r--` (file), `drwxr-xr-x` (directory)
- 5 SUID binaries ki list (passwd, sudo, etc.)

### **14. Extra / Advanced Jaankari (Optional)**
- **umask:** Default permissions control karta hai. `umask 022` se files `644` aur directories `755` banenge
- **ACLs (Access Control Lists):** Advanced permissions - specific users ko specific permissions
- **Capabilities:** Modern alternative to SUID - granular permissions
- **Immutable Flag:** `chattr +i` se file ko completely lock kar sakte hain

### **15. Aakhri Choti Summary (5 lines)**
- Permissions teen types hain: Read (r), Write (w), Execute (x)
- Teen categories hain: Owner (u), Group (g), Others (o)
- `ls -l` se permissions dekhte hain format: `rwxrwxrwx`
- SUID/SGID special permissions hain jo privilege escalation mein use hote hain
- Proper permissions security ki foundation hain

> **Ye Zaroor Yaad Rakhein**
> 1. `r=4, w=2, x=1` - Octal values yaad rakhein
> 2. Directory ko `x` permission zaroori hai access ke liye
> 3. SUID files (4000) privilege escalation ke liye gold mine hain
> 4. `chmod 777` kabhi use na karein production mein
> 5. Sensitive files ko `600` ya `400` permissions dein

---

