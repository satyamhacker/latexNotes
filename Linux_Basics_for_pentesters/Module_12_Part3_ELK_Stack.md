# **Module 12: Professional Monitoring & Alerting (Part 3)** ğŸ“ŠğŸ“ˆ

---

## **Topic 3: Log Visualization with ELK Stack (Basic Concept)** ğŸ“ŠğŸ”

---

### **1ï¸âƒ£ Topic Summary**

ELK Stack (Elasticsearch, Logstash, Kibana) ek powerful log management solution hai jo logs ko collect, process, store, aur visualize karta hai - centralized logging with beautiful dashboards aur powerful search capabilities.

---

### **2ï¸âƒ£ Detailed Explanation** ğŸ§ 

**ELK Stack Components:**

1. **Elasticsearch** - Search and analytics engine (data storage)
2. **Logstash** - Data processing pipeline (log collection & parsing)
3. **Kibana** - Visualization platform (dashboards & search UI)
4. **Beats** (optional) - Lightweight data shippers (Filebeat, Metricbeat)

**Data Flow:**
```
Logs â†’ Filebeat â†’ Logstash â†’ Elasticsearch â†’ Kibana
```

**Analogy:**
- **Filebeat** = Mail collector (picks up logs)
- **Logstash** = Sorting center (processes & filters)
- **Elasticsearch** = Warehouse (stores searchable data)
- **Kibana** = Display window (beautiful visualization)

---

### **3ï¸âƒ£ Why Important?** ğŸ¯

**Admin:**
- Centralized log management
- Powerful search across all logs
- Real-time monitoring
- Security incident investigation
- Compliance reporting
- Beautiful dashboards

**Pentester:**
- ELK endpoints discovery
- Log data analysis
- Attack trace identification
- Infrastructure mapping
- Sensitive data in logs

---

### **4ï¸âƒ£ Basic Installation** ğŸ“

#### **Install Elasticsearch:**
```bash
# Add repository
wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -
echo "deb https://artifacts.elastic.co/packages/8.x/apt stable main" | sudo tee /etc/apt/sources.list.d/elastic-8.x.list

# Install
sudo apt update
sudo apt install elasticsearch

# Start
sudo systemctl start elasticsearch
sudo systemctl enable elasticsearch

# Test
curl -X GET "localhost:9200/"
```

---

#### **Install Kibana:**
```bash
# Install
sudo apt install kibana

# Configure
sudo nano /etc/kibana/kibana.yml
# server.host: "0.0.0.0"
# elasticsearch.hosts: ["http://localhost:9200"]

# Start
sudo systemctl start kibana
sudo systemctl enable kibana
```

**Access:** http://localhost:5601

---

#### **Install Filebeat:**
```bash
# Install
sudo apt install filebeat

# Configure
sudo nano /etc/filebeat/filebeat.yml
```

**Basic config:**
```yaml
filebeat.inputs:
  - type: log
    enabled: true
    paths:
      - /var/log/syslog
      - /var/log/auth.log

output.elasticsearch:
  hosts: ["localhost:9200"]

setup.kibana:
  host: "localhost:5601"
```

```bash
# Setup
sudo filebeat setup
sudo systemctl start filebeat
sudo systemctl enable filebeat
```

---

### **5ï¸âƒ£ Key Features** ğŸ’»

#### **Elasticsearch Queries:**
```bash
# Search all logs
curl -X GET "localhost:9200/_search?pretty"

# Search specific term
curl -X GET "localhost:9200/_search?q=failed&pretty"

# Count documents
curl -X GET "localhost:9200/_count?pretty"
```

---

#### **Kibana Features:**

**Discover:**
- Search logs with filters
- Time-based filtering
- Field analysis

**Visualize:**
- Create charts, graphs, maps
- Pie charts, bar charts, line graphs
- Heatmaps, gauges

**Dashboard:**
- Combine multiple visualizations
- Real-time updates
- Shareable dashboards

**Alerting:**
- Setup alerts on conditions
- Email/Slack notifications
- Threshold-based alerts

---

### **6ï¸âƒ£ Common Use Cases** ğŸ’¼

**Admin:**
```
1. SSH Login Monitoring
   - Filter: "sshd" AND "Accepted"
   - Visualization: Timeline of logins
   - Alert: Failed login > 5 in 5 minutes

2. Error Log Analysis
   - Filter: log.level: "error"
   - Visualization: Error count by service
   - Dashboard: Real-time error tracking

3. Web Server Logs
   - Filter: nginx access logs
   - Visualization: Top URLs, response codes
   - Dashboard: Traffic analysis
```

**Pentester:**
```
1. Endpoint Discovery
   - Check ports: 9200 (Elasticsearch), 5601 (Kibana)
   - Access: http://target:9200/_cat/indices
   
2. Data Enumeration
   - List indices: /_cat/indices?v
   - Search logs: /_search?q=password
   
3. Infrastructure Mapping
   - Analyze logs for IPs, hostnames
   - Identify services and versions
```

---

### **7ï¸âƒ£ Security Considerations** ğŸ”’

**Admin Best Practices:**
```bash
# 1. Enable authentication
xpack.security.enabled: true

# 2. Use firewall
sudo ufw allow from TRUSTED_IP to any port 9200
sudo ufw allow from TRUSTED_IP to any port 5601

# 3. Use HTTPS
xpack.security.http.ssl.enabled: true

# 4. Regular backups
curl -X PUT "localhost:9200/_snapshot/my_backup"

# 5. Monitor access logs
tail -f /var/log/elasticsearch/elasticsearch.log
```

**Pentester Checks:**
```bash
# Check if exposed
nmap -p 9200,5601 target

# Test authentication
curl http://target:9200/

# Enumerate indices
curl http://target:9200/_cat/indices?v

# Search for sensitive data
curl "http://target:9200/_search?q=password&pretty"
curl "http://target:9200/_search?q=api_key&pretty"
```

---

### **8ï¸âƒ£ Real-World Scenario** ğŸŒ

**Admin - Security Monitoring:**
```
Setup:
1. Install ELK Stack
2. Configure Filebeat on all servers
3. Forward auth.log, syslog, nginx logs
4. Create Kibana dashboard:
   - Failed SSH attempts (map)
   - Top error messages (table)
   - Traffic by country (pie chart)
   - Response time (line graph)
5. Setup alerts:
   - Failed login > 5 in 5 min
   - Error rate > 10/min
   - Disk usage > 90%

Result: Real-time security monitoring!
```

**Pentester - Reconnaissance:**
```
Discovery:
1. Port scan: nmap -p 9200,5601 target-network
2. Found: http://192.168.1.100:9200 (no auth!)
3. Enumerate: curl http://192.168.1.100:9200/_cat/indices
4. Search logs: curl "http://192.168.1.100:9200/_search?q=mysql"
5. Found: Database credentials in application logs
6. Extract: curl "http://192.168.1.100:9200/app-logs/_search?q=password&pretty"

Finding: Exposed Elasticsearch with sensitive data!
```

---

### **9ï¸âƒ£ Key Takeaways** ğŸ“Œ

**Components:**
- **Elasticsearch** = Storage + Search
- **Logstash** = Processing
- **Kibana** = Visualization
- **Filebeat** = Log shipping

**Ports:**
- 9200 = Elasticsearch
- 5601 = Kibana
- 5044 = Logstash

**Admin:**
- âœ… Centralized log management
- âœ… Powerful search capabilities
- âœ… Beautiful dashboards
- âœ… Real-time monitoring
- âœ… Secure properly (auth + firewall)

**Pentester:**
- ğŸ” Check ports 9200, 5601
- ğŸ” Test for authentication
- ğŸ” Enumerate indices
- ğŸ” Search for sensitive data
- ğŸ” Map infrastructure from logs

---

**Module 12 Complete! ğŸ‰**

**Topics Covered:**
1. âœ… Command-line Monitoring Tools
2. âœ… Prometheus + Grafana
3. âœ… ELK Stack

**Next:** Module 13 - Miscellaneous Services ğŸ”§

---

**Happy Log Analyzing! ğŸ“ŠğŸ”**
