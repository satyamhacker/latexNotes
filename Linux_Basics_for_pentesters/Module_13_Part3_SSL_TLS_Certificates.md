# **Module 13: Miscellaneous Services & Techniques (Part 3)** üîß‚öôÔ∏è

---

## **Topic 3: SSL/TLS Certificate Management (Let's Encrypt & Certbot)** üîêüåê

---

### **1Ô∏è‚É£ Topic Summary (1-2 lines)**

SSL/TLS certificates website ko HTTPS enable karte hain (encrypted communication), aur Let's Encrypt ek free, automated certificate authority hai jo Certbot tool se easily certificates issue aur renew karta hai! üöÄüîí

---

### **2Ô∏è‚É£ Detailed Explanation with Analogy** üß†

**Kya hai SSL/TLS?**

- **SSL** = Secure Sockets Layer (old name)
- **TLS** = Transport Layer Security (modern name)
- **Purpose** = Encrypt data between browser and server

**Certificate Components:**
- **Public Key** - Encryption ke liye (public)
- **Private Key** - Decryption ke liye (secret)
- **Certificate** - Identity proof (CA signed)
- **CA** = Certificate Authority (trusted third party)

**Let's Encrypt:**
- **Free** SSL certificates
- **Automated** issuance and renewal
- **90-day** validity (auto-renewal recommended)
- **Domain Validation** (DV) certificates

**Certbot:**
- Official Let's Encrypt client
- Automates certificate management
- Supports Apache, Nginx, standalone
- Auto-renewal setup

**Analogy:**
Socho SSL certificate ek **passport** hai:

- **Website** = Person traveling (your server)
- **Certificate** = Passport (identity proof)
- **CA (Let's Encrypt)** = Passport office (issues passport)
- **Browser** = Immigration officer (verifies passport)
- **Private Key** = Signature (only you can sign)
- **Public Key** = Photo (everyone can see)
- **HTTPS** = Secure border crossing (encrypted tunnel)

Jaise passport ke bina international travel risky hai, waise hi SSL ke bina website data transfer risky hai! Browser "Not Secure" warning dikhata hai.

**HTTP vs HTTPS:**
```
HTTP  = Postcard (anyone can read)
HTTPS = Sealed envelope (only recipient can read)
```

---

### **3Ô∏è‚É£ Why is this Important?** üéØ

**System Admin Perspective:**
- ‚úÖ **Data Encryption** - User data secure rehta hai
- ‚úÖ **Trust & Credibility** - Browser "Secure" dikhata hai
- ‚úÖ **SEO Ranking** - Google HTTPS sites ko prefer karta
- ‚úÖ **Compliance** - PCI-DSS, GDPR requirements
- ‚úÖ **Authentication** - Server identity verify hoti hai
- ‚úÖ **Free Certificates** - Let's Encrypt = No cost!

**Pentester Perspective:**
- üîç **Certificate Enumeration** - Subdomains discover karna
- üîç **Expired Certificates** - Misconfiguration finding
- üîç **Self-Signed Certs** - Trust issues exploit
- üîç **Weak Ciphers** - SSL/TLS vulnerabilities
- üîç **Certificate Transparency** - Historical data
- üîç **Man-in-the-Middle** - SSL stripping attacks

---

### **4Ô∏è‚É£ Real-World Use Cases** üíº

**Admin Use Cases:**
1. **E-commerce Website** - Payment data encryption
2. **Login Pages** - Password transmission security
3. **API Endpoints** - Secure API communication
4. **Email Servers** - SMTP/IMAP encryption
5. **Internal Services** - Admin panels, dashboards
6. **Mobile Apps** - Backend API security

**Pentester Use Cases:**
1. **Subdomain Discovery** - Certificate transparency logs
2. **SSL/TLS Testing** - Weak cipher detection
3. **Certificate Validation** - Self-signed cert detection
4. **Expired Certificates** - Misconfiguration finding
5. **SSL Stripping** - Downgrade attacks
6. **Certificate Pinning** - Bypass testing

---

### **5Ô∏è‚É£ What if NOT Done Properly?** ‚ö†Ô∏è

**Admin Consequences:**
- ‚ùå **Data Breach** - Passwords, credit cards intercepted
- ‚ùå **Browser Warnings** - "Not Secure" scares users
- ‚ùå **SEO Penalty** - Lower Google rankings
- ‚ùå **Compliance Violation** - Legal issues
- ‚ùå **Man-in-the-Middle** - Attacker intercepts traffic
- ‚ùå **Lost Revenue** - Users don't trust site

**Security Issues:**
- üö® **Expired Certificate** - Browser blocks access
- üö® **Self-Signed Certificate** - Trust warnings
- üö® **Weak Ciphers** - SSL/TLS vulnerabilities (POODLE, BEAST)
- üö® **Mixed Content** - HTTP resources on HTTPS page
- üö® **Certificate Mismatch** - Domain name doesn't match

---

### **6Ô∏è‚É£ Syntax & Installation** üìù

#### **Install Certbot:**
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install certbot python3-certbot-nginx
# OR for Apache:
sudo apt install certbot python3-certbot-apache

# CentOS/RHEL 8
sudo dnf install certbot python3-certbot-nginx

# CentOS/RHEL 7
sudo yum install certbot python2-certbot-nginx
```

#### **Basic Certbot Commands:**
```bash
# Obtain certificate (Nginx)
sudo certbot --nginx -d example.com -d www.example.com

# Obtain certificate (Apache)
sudo certbot --apache -d example.com

# Standalone (no web server)
sudo certbot certonly --standalone -d example.com

# Webroot (existing web server)
sudo certbot certonly --webroot -w /var/www/html -d example.com

# Renew certificates
sudo certbot renew

# Test renewal
sudo certbot renew --dry-run

# List certificates
sudo certbot certificates

# Delete certificate
sudo certbot delete --cert-name example.com
```

---

### **7Ô∏è‚É£ Detailed Examples with Tables** üíª

#### **Example 1: Nginx with Let's Encrypt (Complete Setup)**

**Step 1: Install Nginx**
```bash
sudo apt update
sudo apt install nginx
sudo systemctl start nginx
sudo systemctl enable nginx
```

**Step 2: Configure Domain**
```bash
# Create server block
sudo nano /etc/nginx/sites-available/example.com
```

```nginx
server {
    listen 80;
    server_name example.com www.example.com;
    
    root /var/www/example.com;
    index index.html;
    
    location / {
        try_files $uri $uri/ =404;
    }
}
```

```bash
# Enable site
sudo ln -s /etc/nginx/sites-available/example.com /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

**Step 3: Create Web Root**
```bash
sudo mkdir -p /var/www/example.com
echo "<h1>Welcome to Example.com</h1>" | sudo tee /var/www/example.com/index.html
```

**Step 4: Install Certbot**
```bash
sudo apt install certbot python3-certbot-nginx
```

**Step 5: Obtain Certificate**
```bash
sudo certbot --nginx -d example.com -d www.example.com
```

**Interactive Prompts:**
```
Enter email address: admin@example.com
Agree to Terms of Service: (Y)es
Share email with EFF: (N)o
```

| **Prompt** | **Input** | **Purpose** |
|-----------|----------|-------------|
| Email | `admin@example.com` | Renewal notifications |
| Terms | `Y` | Accept Let's Encrypt ToS |
| EFF Newsletter | `N` (optional) | Marketing emails |

**Certbot Output:**
```
Requesting a certificate for example.com and www.example.com

Successfully received certificate.
Certificate is saved at: /etc/letsencrypt/live/example.com/fullchain.pem
Key is saved at: /etc/letsencrypt/live/example.com/privkey.pem
This certificate expires on 2024-06-15.
These files will be updated when the certificate renews.

Deploying certificate
Successfully deployed certificate for example.com to /etc/nginx/sites-enabled/example.com
Successfully deployed certificate for www.example.com to /etc/nginx/sites-enabled/example.com
Congratulations! You have successfully enabled HTTPS on https://example.com and https://www.example.com
```

**Step 6: Verify Configuration**
```bash
# Check Nginx config
sudo nginx -t

# View updated config
sudo cat /etc/nginx/sites-available/example.com
```

**Auto-Generated Nginx Config:**
```nginx
server {
    server_name example.com www.example.com;
    
    root /var/www/example.com;
    index index.html;
    
    location / {
        try_files $uri $uri/ =404;
    }

    listen 443 ssl; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
}

server {
    if ($host = www.example.com) {
        return 301 https://$host$request_uri;
    } # managed by Certbot

    if ($host = example.com) {
        return 301 https://$host$request_uri;
    } # managed by Certbot

    listen 80;
    server_name example.com www.example.com;
    return 404; # managed by Certbot
}
```

| **Directive** | **Value** | **Purpose** |
|--------------|-----------|-------------|
| `listen 443 ssl` | HTTPS port | SSL/TLS enabled |
| `ssl_certificate` | `/etc/letsencrypt/live/.../fullchain.pem` | Public certificate |
| `ssl_certificate_key` | `/etc/letsencrypt/live/.../privkey.pem` | Private key |
| `return 301 https://...` | HTTP to HTTPS redirect | Force HTTPS |

**Step 7: Test HTTPS**
```bash
# Test with curl
curl -I https://example.com

# Output:
# HTTP/2 200
# server: nginx
# ...
```

---

#### **Example 2: Apache with Let's Encrypt**

**Setup:**
```bash
# Install Apache
sudo apt install apache2
sudo systemctl start apache2

# Install Certbot
sudo apt install certbot python3-certbot-apache

# Create virtual host
sudo nano /etc/apache2/sites-available/example.com.conf
```

```apache
<VirtualHost *:80>
    ServerName example.com
    ServerAlias www.example.com
    DocumentRoot /var/www/example.com
    
    <Directory /var/www/example.com>
        AllowOverride All
        Require all granted
    </Directory>
    
    ErrorLog ${APACHE_LOG_DIR}/example.com-error.log
    CustomLog ${APACHE_LOG_DIR}/example.com-access.log combined
</VirtualHost>
```

```bash
# Enable site
sudo a2ensite example.com.conf
sudo systemctl reload apache2

# Obtain certificate
sudo certbot --apache -d example.com -d www.example.com
```

**Auto-Generated SSL Config:**
```apache
<VirtualHost *:443>
    ServerName example.com
    ServerAlias www.example.com
    DocumentRoot /var/www/example.com
    
    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/example.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/example.com/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf
</VirtualHost>
```

---

#### **Example 3: Standalone Mode (No Web Server)**

**Use Case:** Certificate chahiye but web server nahi hai (ya temporarily stop kar sakte ho)

```bash
# Stop web server (if running)
sudo systemctl stop nginx

# Obtain certificate
sudo certbot certonly --standalone -d example.com -d www.example.com

# Certificate saved at:
# /etc/letsencrypt/live/example.com/fullchain.pem
# /etc/letsencrypt/live/example.com/privkey.pem

# Start web server
sudo systemctl start nginx

# Manually configure Nginx/Apache to use certificates
```

| **Mode** | **When to Use** | **Requirement** |
|---------|----------------|-----------------|
| `--nginx` | Nginx running | Auto-configures Nginx |
| `--apache` | Apache running | Auto-configures Apache |
| `--standalone` | No web server | Port 80 must be free |
| `--webroot` | Custom web server | Webroot path needed |

---

#### **Example 4: Wildcard Certificate**

**Wildcard** = `*.example.com` (covers all subdomains)

```bash
# Requires DNS validation
sudo certbot certonly --manual --preferred-challenges dns -d example.com -d *.example.com
```

**Process:**
```
Certbot will ask you to add TXT record:
_acme-challenge.example.com TXT "random_string_here"

Steps:
1. Go to DNS provider (Cloudflare, GoDaddy, etc.)
2. Add TXT record as shown
3. Wait for DNS propagation (1-5 minutes)
4. Press Enter in Certbot
5. Certificate issued!
```

| **Challenge Type** | **Validation Method** | **Use Case** |
|-------------------|---------------------|--------------|
| `http-01` | HTTP file on port 80 | Single domain, web server |
| `dns-01` | DNS TXT record | Wildcard, no web server |
| `tls-alpn-01` | TLS on port 443 | Advanced use cases |

---

### **8Ô∏è‚É£ Common Mistakes & How to Avoid** ‚ùå‚û°Ô∏è‚úÖ

| **Mistake** | **Problem** | **Solution** |
|------------|-------------|--------------|
| Port 80 blocked | Certbot can't validate | Open port 80 in firewall |
| Wrong domain DNS | Domain doesn't point to server | Update A record to server IP |
| Firewall blocking | Validation fails | `sudo ufw allow 80/tcp` |
| Forgot to renew | Certificate expires | Setup auto-renewal cron |
| Mixed content | HTTPS page loads HTTP resources | Update all URLs to HTTPS |
| Certificate for wrong domain | Browser warning | Use correct domain in command |
| No email provided | Can't receive renewal notices | Provide valid email |
| Webroot path wrong | Validation fails | Check DocumentRoot path |

---

### **9Ô∏è‚É£ Best Practices & Pro Tips** ‚≠ê

**Auto-Renewal Setup:**
```bash
# Certbot automatically creates systemd timer
sudo systemctl status certbot.timer

# Or cron job (if timer not present)
sudo crontab -e
# Add:
0 0,12 * * * certbot renew --quiet

# Test renewal
sudo certbot renew --dry-run
```

**Security Hardening:**
```nginx
# Nginx SSL optimization
ssl_protocols TLSv1.2 TLSv1.3;
ssl_prefer_server_ciphers on;
ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256';
ssl_session_cache shared:SSL:10m;
ssl_session_timeout 10m;
ssl_stapling on;
ssl_stapling_verify on;

# HSTS (HTTP Strict Transport Security)
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

# Security headers
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-Content-Type-Options "nosniff" always;
add_header X-XSS-Protection "1; mode=block" always;
```

**Certificate Monitoring:**
```bash
# Check expiry date
sudo certbot certificates

# Output:
# Certificate Name: example.com
#   Domains: example.com www.example.com
#   Expiry Date: 2024-06-15 12:00:00+00:00 (VALID: 89 days)
#   Certificate Path: /etc/letsencrypt/live/example.com/fullchain.pem
#   Private Key Path: /etc/letsencrypt/live/example.com/privkey.pem

# Check with OpenSSL
echo | openssl s_client -servername example.com -connect example.com:443 2>/dev/null | openssl x509 -noout -dates
```

**Pro Tips:**
- üí° **Test first**: Use `--dry-run` before actual renewal
- üí° **Monitor expiry**: Setup alerts 30 days before expiry
- üí° **Backup certificates**: `/etc/letsencrypt/` directory
- üí° **Use DNS validation**: For wildcard certificates
- üí° **Rate limits**: Let's Encrypt has limits (50 certs/week per domain)
- üí° **Staging environment**: Use `--staging` for testing

---

### **üîü Real-World Scenario** üåç

#### **Scenario 1: Admin - E-commerce Website SSL Setup**

**Requirement:**
```
Website: shop.example.com
Server: Ubuntu 20.04 + Nginx
Need: HTTPS for payment security
```

**Implementation:**
```bash
# 1. Install Nginx
sudo apt update
sudo apt install nginx

# 2. Configure domain
sudo nano /etc/nginx/sites-available/shop.example.com
```

```nginx
server {
    listen 80;
    server_name shop.example.com;
    root /var/www/shop;
    index index.html;
}
```

```bash
# 3. Enable site
sudo ln -s /etc/nginx/sites-available/shop.example.com /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx

# 4. Install Certbot
sudo apt install certbot python3-certbot-nginx

# 5. Obtain certificate
sudo certbot --nginx -d shop.example.com
# Email: admin@example.com
# Agree to ToS: Yes
# Redirect HTTP to HTTPS: Yes (option 2)

# 6. Verify
curl -I https://shop.example.com
# HTTP/2 200 ‚úì

# 7. Setup auto-renewal
sudo certbot renew --dry-run
# Success! ‚úì

# 8. Add security headers
sudo nano /etc/nginx/sites-available/shop.example.com
```

```nginx
# Add inside server block:
add_header Strict-Transport-Security "max-age=31536000" always;
add_header X-Frame-Options "DENY" always;
add_header X-Content-Type-Options "nosniff" always;
```

```bash
sudo systemctl reload nginx
```

**Result:** Secure e-commerce site with A+ SSL rating! üîí‚úÖ

---

#### **Scenario 2: Pentester - Certificate Transparency Recon**

**Target:** example.com
**Goal:** Discover subdomains

**Method 1: crt.sh (Certificate Transparency Logs)**
```bash
# Query crt.sh
curl -s "https://crt.sh/?q=%.example.com&output=json" | jq -r '.[].name_value' | sort -u

# Output:
# example.com
# www.example.com
# admin.example.com
# dev.example.com
# staging.example.com
# api.example.com
```

**Method 2: certspotter**
```bash
# Install
go install github.com/SSLMate/certspotter/cmd/certspotter@latest

# Search
certspotter -domain example.com
```

**Method 3: Manual OpenSSL Check**
```bash
# Check certificate details
echo | openssl s_client -servername example.com -connect example.com:443 2>/dev/null | openssl x509 -noout -text

# Extract SANs (Subject Alternative Names)
echo | openssl s_client -servername example.com -connect example.com:443 2>/dev/null | openssl x509 -noout -text | grep "DNS:"
```

**Findings:**
```
Discovered subdomains:
‚úì admin.example.com (admin panel!)
‚úì dev.example.com (development server!)
‚úì staging.example.com (staging environment!)
‚úì api.example.com (API endpoint!)

Next steps:
1. Port scan discovered subdomains
2. Check for weak authentication
3. Test for vulnerabilities
```

**Result:** Certificate transparency revealed hidden subdomains! üîç

---

#### **Scenario 3: Admin - Certificate Renewal Failure**

**Problem:**
```
Email received: "Certificate expiring in 7 days"
Auto-renewal failed
Website will show security warning!
```

**Troubleshooting:**
```bash
# 1. Check renewal logs
sudo tail -f /var/log/letsencrypt/letsencrypt.log

# Error found:
# "Challenge failed for domain example.com"
# "Connection refused on port 80"

# 2. Check firewall
sudo ufw status
# Port 80 blocked! ‚ùå

# 3. Fix firewall
sudo ufw allow 80/tcp
sudo ufw reload

# 4. Test renewal
sudo certbot renew --dry-run
# Success! ‚úì

# 5. Force renewal
sudo certbot renew --force-renewal

# 6. Verify
sudo certbot certificates
# Expiry Date: 2024-09-15 (VALID: 89 days) ‚úì
```

**Root Cause:** Firewall rule accidentally blocked port 80

**Prevention:**
```bash
# Monitor certificate expiry
# Add to cron:
0 0 * * * certbot renew --quiet && systemctl reload nginx

# Setup monitoring alert
# Use services like:
# - SSL Labs (ssllabs.com)
# - Uptime Robot
# - Pingdom
```

**Result:** Certificate renewed, website secure! üîí‚úÖ

---

### **1Ô∏è‚É£1Ô∏è‚É£ Troubleshooting Checklist** ‚úÖ

**Certificate Validation Fails:**
```bash
# Check DNS
dig example.com +short
# Should return your server IP

# Check port 80 accessible
curl -I http://example.com

# Check firewall
sudo ufw status
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# Check web server running
sudo systemctl status nginx

# Check logs
sudo tail -f /var/log/letsencrypt/letsencrypt.log
```

**Browser Shows "Not Secure":**
```bash
# Check certificate installed
sudo certbot certificates

# Check Nginx/Apache config
sudo nginx -t
sudo apache2ctl configtest

# Check certificate files exist
ls -la /etc/letsencrypt/live/example.com/

# Reload web server
sudo systemctl reload nginx
```

**Mixed Content Warning:**
```bash
# Find HTTP resources on HTTPS page
# Check browser console (F12)

# Fix: Update all URLs to HTTPS
# In HTML/CSS/JS:
# http://example.com/image.jpg ‚Üí https://example.com/image.jpg
# Or use protocol-relative: //example.com/image.jpg
```

**Renewal Fails:**
```bash
# Test renewal
sudo certbot renew --dry-run

# Check timer/cron
sudo systemctl status certbot.timer
sudo crontab -l

# Manual renewal
sudo certbot renew --force-renewal

# Check rate limits
# Let's Encrypt: 50 certificates per week per domain
```

---

### **1Ô∏è‚É£2Ô∏è‚É£ FAQs** ‚ùì

**Q1: Let's Encrypt free hai, toh paid certificates kyun kharidein?**
```
Let's Encrypt (Free):
- Domain Validation (DV) only
- 90-day validity
- No warranty
- Community support
- Perfect for most websites

Paid Certificates:
- Organization Validation (OV)
- Extended Validation (EV) - green bar
- 1-2 year validity
- Warranty ($10K-$1.75M)
- 24/7 support
- Better for enterprises

For most cases: Let's Encrypt is enough!
```

**Q2: Wildcard certificate kab use karein?**
```
Use wildcard (*.example.com) when:
- Multiple subdomains hai
- Subdomains dynamically create hote hain
- Ek certificate se sab cover karna hai

Note: Requires DNS validation
Command: certbot certonly --manual --preferred-challenges dns -d *.example.com
```

**Q3: Certificate expire hone se pehle kitne din renew karein?**
```
Let's Encrypt certificates: 90 days validity
Auto-renewal: 30 days before expiry

Certbot automatically renews when <30 days left
Manual check: sudo certbot renew --dry-run

Best practice: Monitor expiry, setup alerts
```

**Q4: Kya multiple domains ek certificate mein ho sakte hain?**
```
Yes! SAN (Subject Alternative Name) certificate

Command:
sudo certbot --nginx -d example.com -d www.example.com -d blog.example.com

Limit: 100 domains per certificate (Let's Encrypt)
```

**Q5: Self-signed certificate kab use karein?**
```
Use cases:
- Internal testing
- Development environment
- Private networks
- Learning purposes

NOT for production websites (browser warning)

Create self-signed:
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout /etc/ssl/private/selfsigned.key \
  -out /etc/ssl/certs/selfsigned.crt
```

---

### **1Ô∏è‚É£3Ô∏è‚É£ Practice Tasks** üéØ

**Beginner:**
1. ‚úÖ Install Certbot on Ubuntu
2. ‚úÖ Obtain certificate for single domain (Nginx)
3. ‚úÖ Verify HTTPS working
4. ‚úÖ Check certificate expiry date
5. ‚úÖ Test auto-renewal with --dry-run

**Intermediate:**
1. ‚úÖ Setup certificate for multiple domains (SAN)
2. ‚úÖ Configure Apache with Let's Encrypt
3. ‚úÖ Implement HTTP to HTTPS redirect
4. ‚úÖ Add security headers (HSTS, X-Frame-Options)
5. ‚úÖ Setup certificate monitoring

**Advanced:**
1. ‚úÖ Obtain wildcard certificate (DNS validation)
2. ‚úÖ Implement certificate pinning
3. ‚úÖ Setup automated renewal with hooks
4. ‚úÖ Configure OCSP stapling
5. ‚úÖ Achieve A+ rating on SSL Labs

**Pentester:**
1. üîç Enumerate subdomains via Certificate Transparency
2. üîç Check for expired certificates
3. üîç Test for weak SSL/TLS ciphers (testssl.sh)
4. üîç Identify self-signed certificates
5. üîç Test SSL stripping attacks

---

### **1Ô∏è‚É£4Ô∏è‚É£ Advanced Information** üöÄ

#### **Certificate Files Explained:**
```bash
/etc/letsencrypt/live/example.com/
‚îú‚îÄ‚îÄ cert.pem         # Server certificate only
‚îú‚îÄ‚îÄ chain.pem        # Intermediate certificates
‚îú‚îÄ‚îÄ fullchain.pem    # cert.pem + chain.pem (use this in Nginx)
‚îî‚îÄ‚îÄ privkey.pem      # Private key (keep secret!)

# Nginx uses: fullchain.pem + privkey.pem
# Apache uses: cert.pem + chain.pem + privkey.pem
```

#### **Renewal Hooks:**
```bash
# Pre-hook (before renewal)
sudo certbot renew --pre-hook "systemctl stop nginx"

# Post-hook (after renewal)
sudo certbot renew --post-hook "systemctl start nginx"

# Deploy-hook (only if renewed)
sudo certbot renew --deploy-hook "systemctl reload nginx"

# Permanent hooks:
sudo nano /etc/letsencrypt/renewal-hooks/deploy/reload-nginx.sh
```

```bash
#!/bin/bash
systemctl reload nginx
```

```bash
sudo chmod +x /etc/letsencrypt/renewal-hooks/deploy/reload-nginx.sh
```

#### **SSL Testing Tools:**
```bash
# testssl.sh - Comprehensive SSL/TLS testing
git clone https://github.com/drwetter/testssl.sh.git
cd testssl.sh
./testssl.sh https://example.com

# SSL Labs API
curl -s "https://api.ssllabs.com/api/v3/analyze?host=example.com" | jq

# Check certificate expiry
echo | openssl s_client -servername example.com -connect example.com:443 2>/dev/null | openssl x509 -noout -dates
```

#### **Rate Limits (Let's Encrypt):**
```
- 50 certificates per registered domain per week
- 5 duplicate certificates per week
- 300 new orders per account per 3 hours
- 10 accounts per IP per 3 hours
- 500 accounts per IP range per 3 hours

Use --staging for testing (no rate limits)
```

---

### **1Ô∏è‚É£5Ô∏è‚É£ Final Summary** üìã

**SSL/TLS = Encrypted Communication (HTTPS)**

**Key Components:**
- ‚úÖ **Certificate** - Identity proof (public)
- ‚úÖ **Private Key** - Decryption key (secret)
- ‚úÖ **CA** - Certificate Authority (Let's Encrypt)
- ‚úÖ **Certbot** - Automation tool

**Installation:**
```bash
sudo apt install certbot python3-certbot-nginx
```

**Obtain Certificate:**
```bash
sudo certbot --nginx -d example.com -d www.example.com
```

**Auto-Renewal:**
```bash
sudo certbot renew --dry-run
```

**Certificate Location:**
```
/etc/letsencrypt/live/example.com/
‚îú‚îÄ‚îÄ fullchain.pem (certificate)
‚îî‚îÄ‚îÄ privkey.pem (private key)
```

**Security Best Practices:**
- üîí Use TLS 1.2+ only
- üîí Strong ciphers
- üîí HSTS header
- üîí OCSP stapling
- üîí Monitor expiry

**Admin:** Free HTTPS, automated renewal, improved SEO
**Pentester:** Subdomain discovery, certificate enumeration, SSL testing

**Remember:** HTTPS is mandatory for modern websites! üîêüåê

---

**Next Topic:** MAC Address Spoofing üé≠

---

**Happy Encrypting! üîí‚ú®**
