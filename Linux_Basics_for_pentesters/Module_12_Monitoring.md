# **Module 12: Professional Monitoring & Alerting** ğŸ“ŠğŸ“ˆ

---

## **Topic 1: Command-line Monitoring Tools** ğŸ’»ğŸ“‰

---

### **1ï¸âƒ£ Topic Summary (1-2 lines)**

Command-line monitoring tools jaise iostat, vmstat, iftop, aur nload real-time system performance metrics provide karte hain - CPU, memory, disk I/O, aur network traffic ko monitor karne ke liye essential tools.

---

### **2ï¸âƒ£ Detailed Explanation with Analogy** ğŸ§ 

**Kya hain Monitoring Tools?**

Monitoring tools system ke health aur performance ko track karte hain. Ye real-time data provide karte hain jo troubleshooting, capacity planning, aur performance optimization ke liye zaroori hai.

**Key Tools:**

1. **iostat** - Disk I/O statistics (read/write operations)
2. **vmstat** - Virtual memory statistics (CPU, memory, swap)
3. **iftop** - Network bandwidth monitoring (per-connection)
4. **nload** - Network traffic visualization (real-time graphs)
5. **htop** - Interactive process viewer (better than top)
6. **iotop** - Disk I/O by process
7. **nethogs** - Network usage by process

**Analogy:**

Monitoring tools ek car ke **dashboard** ki tarah hain:
- **iostat** = Fuel gauge (disk usage)
- **vmstat** = Speedometer + temperature gauge (CPU + memory)
- **iftop** = GPS with traffic info (network connections)
- **nload** = Real-time speed indicator (network bandwidth)
- **htop** = Complete instrument cluster (all processes)

---

### **3ï¸âƒ£ Why is this Important?** ğŸ¯

**Sysadmin Perspective:**
- Performance bottleneck identification
- Capacity planning
- Troubleshooting slow systems
- Resource optimization
- Proactive monitoring
- Incident response

**Pentester Perspective:**
- System resource usage patterns
- Network traffic analysis
- Process identification
- Service enumeration
- Attack impact assessment
- Stealth operation planning

---

### **4ï¸âƒ£ Real-World Use Cases** ğŸ’¼

**Admin Use Cases:**
1. Identify disk I/O bottlenecks
2. Monitor memory usage and swap
3. Track network bandwidth usage
4. Find resource-hungry processes
5. Capacity planning for scaling

**Pentester Use Cases:**
1. Monitor attack impact on system
2. Identify running services
3. Network traffic analysis
4. Stealth operation (low resource usage)
5. Exfiltration bandwidth planning

---

### **5ï¸âƒ£ Consequences of Not Knowing** âš ï¸

**Admin Problems:**
- âŒ Performance issues undetected
- âŒ Bottlenecks not identified
- âŒ Capacity planning impossible
- âŒ Troubleshooting time increase
- âŒ System crashes unexpected

**Pentester Problems:**
- âŒ Attack impact unknown
- âŒ Resource usage patterns miss
- âŒ Network traffic unmonitored
- âŒ Detection risk increase
- âŒ Stealth operations compromised

---

### **6ï¸âƒ£ Syntax & Command Structure** ğŸ“

#### **iostat:**
```bash
iostat [options] [interval] [count]

Options:
-x    Extended statistics
-d    Display device statistics
-c    Display CPU statistics
-m    Display in MB/s
-h    Human-readable
```

#### **vmstat:**
```bash
vmstat [options] [interval] [count]

Options:
-a    Active/inactive memory
-s    Memory statistics
-d    Disk statistics
-p    Partition statistics
```

#### **iftop:**
```bash
iftop [options]

Options:
-i interface    Monitor specific interface
-n              Don't resolve hostnames
-N              Don't resolve ports
-P              Show ports
-B              Display in bytes
```

#### **nload:**
```bash
nload [options] [interface]

Options:
-m              Show multiple interfaces
-u              Units (h=human, b=bits, k=kbits, m=mbits)
-t interval     Refresh interval
```

---

### **7ï¸âƒ£ Detailed Examples with Explanation Tables** ğŸ’»

#### **Example 1: iostat - Disk I/O Statistics**

```bash
iostat -x 2 5
```

| Part | Explanation |
|------|-------------|
| `iostat` | I/O statistics command |
| `-x` | Extended statistics |
| `2` | Update every 2 seconds |
| `5` | Show 5 iterations |

**Output:**
```
Device            r/s     w/s     rkB/s   wkB/s   %util
sda              5.23   15.67    234.5   1234.2   12.5
sdb              0.12    2.34     12.3     45.6    2.3
```

| Column | Meaning |
|--------|---------|
| `r/s` | Reads per second |
| `w/s` | Writes per second |
| `rkB/s` | KB read per second |
| `wkB/s` | KB written per second |
| `%util` | Disk utilization % |

---

#### **Example 2: vmstat - Memory and CPU**

```bash
vmstat 2 5
```

**Output:**
```
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 1  0      0 234567  12345 567890    0    0    12    45  123  456 15  5 78  2  0
```

| Column | Meaning |
|--------|---------|
| `r` | Processes waiting for CPU |
| `b` | Processes in uninterruptible sleep |
| `swpd` | Virtual memory used (KB) |
| `free` | Free memory (KB) |
| `buff` | Buffer memory (KB) |
| `cache` | Cache memory (KB) |
| `si` | Memory swapped in from disk |
| `so` | Memory swapped out to disk |
| `us` | User CPU time % |
| `sy` | System CPU time % |
| `id` | Idle CPU time % |
| `wa` | Wait I/O time % |

---

#### **Example 3: iftop - Network Connections**

```bash
sudo iftop -i eth0 -n -P
```

| Part | Explanation |
|------|-------------|
| `iftop` | Network monitoring |
| `-i eth0` | Monitor eth0 interface |
| `-n` | Don't resolve hostnames |
| `-P` | Show ports |

**Output:**
```
192.168.1.100:22    => 192.168.1.200:54321    2.5Mb  1.8Mb  1.2Mb
192.168.1.100:80    => 192.168.1.201:54322    500Kb  450Kb  400Kb
192.168.1.100:443   => 192.168.1.202:54323    1.2Mb  1.0Mb  900Kb
```

**Columns:** Current, 2s average, 10s average bandwidth

---

#### **Example 4: nload - Network Traffic Visualization**

```bash
nload -m eth0 eth1
```

| Part | Explanation |
|------|-------------|
| `nload` | Network load monitor |
| `-m` | Multiple interfaces |
| `eth0 eth1` | Interfaces to monitor |

**Output:**
```
Device eth0 [192.168.1.100] (1/2):
================================================================================
Incoming:
################                                    Curr: 2.45 MBit/s
                                                    Avg: 1.89 MBit/s
                                                    Min: 0.12 MBit/s
                                                    Max: 5.67 MBit/s
Outgoing:
########                                            Curr: 1.23 MBit/s
                                                    Avg: 0.98 MBit/s
                                                    Min: 0.05 MBit/s
                                                    Max: 2.34 MBit/s
```

---

#### **Example 5: htop - Interactive Process Viewer**

```bash
htop
```

**Features:**
- Color-coded CPU/memory bars
- Tree view of processes
- Sort by CPU, memory, time
- Kill processes interactively
- Search and filter

**Keyboard shortcuts:**
- `F3` - Search
- `F4` - Filter
- `F5` - Tree view
- `F6` - Sort by
- `F9` - Kill process
- `F10` - Quit

---

#### **Example 6: iotop - Disk I/O by Process**

```bash
sudo iotop -o
```

| Part | Explanation |
|------|-------------|
| `iotop` | I/O top command |
| `-o` | Only show processes doing I/O |

**Output:**
```
TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO>    COMMAND
1234 be/4  mysql    12.5 M/s   45.6 M/s    0.00 %  15.23 % mysqld
5678 be/4  www-data  2.3 M/s    5.6 M/s    0.00 %   3.45 % nginx
```

---

#### **Example 7: nethogs - Network Usage by Process**

```bash
sudo nethogs eth0
```

**Output:**
```
PID   USER     PROGRAM              DEV    SENT    RECEIVED
1234  mysql    mysqld               eth0   2.5 KB  15.6 KB
5678  www-data nginx                eth0   45.2 KB 123.4 KB
9012  admin    sshd                 eth0   1.2 KB  3.4 KB
```

---

#### **Example 8: Combine Multiple Tools**

```bash
# Terminal 1: CPU and Memory
watch -n 2 'vmstat 1 2 | tail -1'

# Terminal 2: Disk I/O
watch -n 2 'iostat -x 1 2 | grep sda'

# Terminal 3: Network
iftop -i eth0

# Terminal 4: Processes
htop
```

---

#### **Example 9: Save Monitoring Data**

```bash
# Log iostat data
iostat -x 5 > /tmp/iostat.log &

# Log vmstat data
vmstat 5 > /tmp/vmstat.log &

# Log for 1 hour then stop
sleep 3600 && killall iostat vmstat
```

---

#### **Example 10: Pentester - System Reconnaissance**

```bash
# Check system load
uptime
# load average: 0.52, 0.48, 0.45

# Check memory
free -h
# Available: 2.3G / 8.0G

# Check disk I/O
iostat -x 1 2
# High I/O on sda = database activity

# Check network connections
sudo iftop -n -P -t -s 5
# Active connections to external IPs

# Check processes
htop
# Identify running services

# Check network usage by process
sudo nethogs eth0
# Identify bandwidth-heavy processes
```

---

### **8ï¸âƒ£ Common Mistakes & How to Avoid** âŒâ¡ï¸âœ…

| Mistake | Problem | Solution |
|---------|---------|----------|
| Not using sudo | Permission denied | Use `sudo` for network tools |
| Wrong interface name | No data shown | Check with `ip a` first |
| Too short interval | System overhead | Use 2-5 second intervals |
| Not saving data | Can't analyze later | Redirect output to file |
| Ignoring %util | Miss disk bottlenecks | Monitor disk utilization |
| Not checking swap | Memory issues missed | Check `si` and `so` in vmstat |
| Forgetting -x in iostat | Limited info | Always use `-x` for details |
| Not using -o in iotop | Too much noise | Use `-o` to show only active I/O |

---

### **9ï¸âƒ£ Best Practices & Pro Tips** â­

**Admin Best Practices:**
1. âœ… **Baseline**: Establish normal performance baselines
2. âœ… **Regular Monitoring**: Check daily during peak hours
3. âœ… **Log Data**: Save monitoring data for analysis
4. âœ… **Multiple Tools**: Use combination for complete picture
5. âœ… **Alerting**: Setup alerts for thresholds
6. âœ… **Documentation**: Document normal vs abnormal patterns
7. âœ… **Trending**: Track metrics over time
8. âœ… **Capacity Planning**: Use data for scaling decisions

**Pentester Pro Tips:**
1. ğŸ” **Stealth**: Monitor your own resource usage
2. ğŸ” **Timing**: Attack during high-load periods (less noticeable)
3. ğŸ” **Bandwidth**: Check available bandwidth before exfiltration
4. ğŸ” **Processes**: Identify security tools (IDS/IPS)
5. ğŸ” **Patterns**: Understand normal traffic patterns
6. ğŸ” **Impact**: Monitor attack impact on system
7. ğŸ” **Detection**: Watch for monitoring tools running
8. ğŸ” **Cleanup**: Ensure tools don't leave traces

---

### **ğŸ”Ÿ Real-World Scenarios** ğŸŒ

#### **Scenario 1: Slow Website Troubleshooting (Admin)**

**Situation:** Website slow ho gayi hai, reason pata karna hai.

**Investigation:**
```bash
# Step 1: Check overall load
uptime
# load average: 8.52, 7.48, 6.45  (High!)

# Step 2: Check CPU and memory
vmstat 2 5
# CPU: us=85%, sy=10%, wa=5%  (CPU bound)

# Step 3: Check disk I/O
iostat -x 2 5
# sda: %util=95%  (Disk bottleneck!)

# Step 4: Find I/O heavy processes
sudo iotop -o
# mysqld using 45 MB/s disk write

# Step 5: Check MySQL queries
mysql -u root -p -e "SHOW PROCESSLIST;"
# Long-running queries found

# Step 6: Check network
sudo iftop -i eth0
# Normal network traffic

# Conclusion: Database queries causing disk I/O bottleneck
```

**Solution:** Optimize MySQL queries, add indexes.

---

#### **Scenario 2: High Memory Usage (Admin)**

**Situation:** Server memory full ho raha hai.

**Investigation:**
```bash
# Check memory
free -h
#               total        used        free      shared  buff/cache   available
# Mem:           7.8G        6.5G        200M        100M        1.1G        900M
# Swap:          2.0G        1.5G        500M

# Check swap activity
vmstat 2 5
# si=1234, so=5678  (Heavy swapping!)

# Find memory-hungry processes
htop
# Sort by memory (F6 -> MEM%)
# nginx: 2.3G
# mysql: 1.8G
# php-fpm: 1.5G

# Check process details
ps aux --sort=-%mem | head -10

# Solution: Increase RAM or optimize applications
```

---

#### **Scenario 3: Network Bandwidth Saturation (Admin)**

**Situation:** Network slow hai, bandwidth check karni hai.

**Investigation:**
```bash
# Check network traffic
nload -m eth0
# Incoming: 95 Mbit/s (near 100 Mbit limit!)
# Outgoing: 85 Mbit/s

# Check connections
sudo iftop -i eth0 -n -P
# Multiple connections to 192.168.1.200:80

# Check which process
sudo nethogs eth0
# nginx: 45 MB/s
# Unknown process: 35 MB/s  (Suspicious!)

# Identify unknown process
ps aux | grep PID
# /tmp/.hidden/miner  (Crypto miner!)

# Kill malicious process
sudo kill -9 PID

# Block source
sudo ufw deny from 192.168.1.200
```

**Finding:** Crypto miner consuming bandwidth!

---

#### **Scenario 4: Capacity Planning (Admin)**

**Situation:** Server scaling ke liye data collect karna hai.

**Solution:**
```bash
# Collect 24-hour data
cat > /usr/local/bin/collect_metrics.sh << 'EOF'
#!/bin/bash
DATE=$(date +%Y%m%d)
LOG_DIR="/var/log/metrics"
mkdir -p $LOG_DIR

# CPU and Memory
vmstat 60 1440 > $LOG_DIR/vmstat_$DATE.log &

# Disk I/O
iostat -x 60 1440 > $LOG_DIR/iostat_$DATE.log &

# Network
iftop -t -s 60 -L 1440 -i eth0 > $LOG_DIR/network_$DATE.log &
EOF

chmod +x /usr/local/bin/collect_metrics.sh

# Run daily
echo "0 0 * * * /usr/local/bin/collect_metrics.sh" | crontab -

# Analyze after 30 days
# Peak CPU: 85%
# Peak Memory: 90%
# Peak Disk I/O: 75%
# Peak Network: 60%

# Decision: Need CPU upgrade (85% peak)
```

---

#### **Scenario 5: Stealth Operation Planning (Pentester)**

**Situation:** Data exfiltration plan karna hai without detection.

**Reconnaissance:**
```bash
# Check current system load
uptime
# load average: 0.25, 0.30, 0.28  (Low load)

# Check available bandwidth
nload eth0
# Incoming: 5 Mbit/s
# Outgoing: 2 Mbit/s
# Available: ~90 Mbit/s

# Check monitoring tools
ps aux | grep -E "iftop|nload|nethogs|iotop"
# No monitoring tools running

# Check network patterns
sudo iftop -t -s 60
# Normal traffic: 2-5 Mbit/s
# Peak traffic: 10 Mbit/s

# Plan exfiltration
# - Use 5 Mbit/s (within normal range)
# - Schedule during business hours (more traffic)
# - Split into small chunks
# - Use encrypted tunnel

# Execute
# Exfiltrate 1GB data at 5 Mbit/s = ~27 minutes
# Spread over 2 hours = undetectable
```

**Result:** Stealth exfiltration successful!

---

### **1ï¸âƒ£1ï¸âƒ£ Checklist for Implementation** âœ…

**Admin Checklist:**
- [ ] Monitoring tools installed
- [ ] Baseline metrics established
- [ ] Regular monitoring schedule
- [ ] Data logging configured
- [ ] Alerting thresholds set
- [ ] Documentation updated
- [ ] Team trained on tools
- [ ] Capacity planning data collected
- [ ] Performance trends tracked
- [ ] Incident response procedures

**Pentester Checklist:**
- [ ] System load checked
- [ ] Memory usage analyzed
- [ ] Disk I/O patterns identified
- [ ] Network bandwidth measured
- [ ] Running processes enumerated
- [ ] Monitoring tools identified
- [ ] Normal patterns documented
- [ ] Stealth operation planned
- [ ] Resource usage minimized
- [ ] Cleanup procedures ready

---

### **1ï¸âƒ£2ï¸âƒ£ Frequently Asked Questions (FAQs)** â“

**Q1: iostat vs iotop - kya farak hai?**
**A:** 
- **iostat**: Device-level I/O statistics
- **iotop**: Process-level I/O statistics

**Q2: vmstat mein high 'wa' ka matlab?**
**A:** High wait I/O = processes waiting for disk I/O = disk bottleneck.

**Q3: iftop mein bandwidth units?**
**A:** Default bits/sec. Press `u` to cycle through units (bits, bytes, packets).

**Q4: Kya monitoring tools performance impact karte hain?**
**A:** Minimal impact. But avoid very short intervals (< 1 second).

**Q5: nload vs iftop - kaunsa better?**
**A:** 
- **nload**: Simple bandwidth visualization
- **iftop**: Detailed per-connection analysis

**Q6: htop vs top - kya farak hai?**
**A:** htop more user-friendly, color-coded, interactive, tree view.

**Q7: Monitoring data kitne time tak store karein?**
**A:** Minimum 30 days for trend analysis. 90 days for capacity planning.

**Q8: Kya monitoring tools root access chahiye?**
**A:** Network tools (iftop, nethogs, iotop) need sudo. Others don't.

---

### **1ï¸âƒ£3ï¸âƒ£ Practice Tasks with Expected Output** ğŸ¯

#### **Task 1: Monitor Disk I/O**
```bash
iostat -x 2 5
```

**Expected:** 5 iterations of disk statistics every 2 seconds.

---

#### **Task 2: Check Memory Usage**
```bash
vmstat 2 5
free -h
```

**Expected:** Memory and swap usage statistics.

---

#### **Task 3: Monitor Network**
```bash
sudo iftop -i eth0 -n
```

**Expected:** Real-time network connections.

---

#### **Task 4: Find Resource-Hungry Processes**
```bash
htop
# Press F6, select %CPU, Enter
```

**Expected:** Processes sorted by CPU usage.

---

### **1ï¸âƒ£4ï¸âƒ£ Advanced Information & Edge Cases** ğŸš€

#### **Advanced Technique 1: Custom Monitoring Script**

```bash
#!/bin/bash
while true; do
    clear
    echo "=== System Monitor ==="
    echo "Time: $(date)"
    echo ""
    echo "=== CPU & Memory ==="
    vmstat 1 2 | tail -1
    echo ""
    echo "=== Disk I/O ==="
    iostat -x 1 2 | grep sda | tail -1
    echo ""
    echo "=== Top Processes ==="
    ps aux --sort=-%cpu | head -5
    sleep 5
done
```

---

#### **Advanced Technique 2: Performance Baseline**

```bash
# Collect baseline during normal operation
iostat -x 60 > baseline_io.log &
vmstat 60 > baseline_vm.log &
sleep 3600
killall iostat vmstat

# Compare during issue
iostat -x 60 > issue_io.log &
vmstat 60 > issue_vm.log &
sleep 3600
killall iostat vmstat

# Analyze difference
diff baseline_io.log issue_io.log
```

---

#### **Edge Case 1: High Load but Low CPU**

```bash
# High load average but low CPU usage
uptime
# load average: 5.0, 4.8, 4.5

vmstat
# CPU idle: 90%

# Reason: Processes waiting for I/O
# Check disk I/O
iostat -x
```

---

#### **Edge Case 2: Memory Leak Detection**

```bash
# Monitor specific process memory over time
while true; do
    ps aux | grep process_name | awk '{print $6}'
    sleep 60
done > memory_usage.log

# Analyze trend
# If continuously increasing = memory leak
```

---

### **1ï¸âƒ£5ï¸âƒ£ Final Summary & Key Takeaways** ğŸ“Œ

**Key Concepts:**
1. **iostat** - Disk I/O monitoring
2. **vmstat** - CPU and memory monitoring
3. **iftop** - Network connection monitoring
4. **nload** - Network bandwidth visualization
5. **htop** - Interactive process monitoring

**Critical Commands:**
```bash
# Disk I/O
iostat -x 2 5

# Memory & CPU
vmstat 2 5

# Network connections
sudo iftop -i eth0 -n

# Network bandwidth
nload eth0

# Processes
htop
```

**Admin Takeaways:**
- âœ… Regular monitoring essential
- âœ… Establish baselines
- âœ… Use multiple tools together
- âœ… Log data for analysis
- âœ… Set up alerting
- âœ… Capacity planning
- âœ… Performance optimization

**Pentester Takeaways:**
- ğŸ” Monitor system before attack
- ğŸ” Check available resources
- ğŸ” Identify monitoring tools
- ğŸ” Plan stealth operations
- ğŸ” Minimize resource usage
- ğŸ” Understand normal patterns
- ğŸ” Monitor attack impact

**Remember:**
- Monitoring = proactive management
- Multiple tools = complete picture
- Baselines = detect anomalies
- Data logging = trend analysis
- Regular checks = prevent issues

**Next Topic:** Prometheus + Grafana ğŸ“Š

---

**Happy Monitoring! ğŸ’»ğŸ“‰**
