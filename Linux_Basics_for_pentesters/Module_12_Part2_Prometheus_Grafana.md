# **Module 12: Professional Monitoring & Alerting (Part 2)** ğŸ“ŠğŸ“ˆ

---

## **Topic 2: Prometheus + Grafana - Server ka "Control Room"** ğŸ›ï¸ğŸ“Š

---

### **1ï¸âƒ£ Topic Summary**

Prometheus metrics collection aur time-series database hai, Grafana visualization tool hai - dono milkar modern monitoring stack banate hain jo real-time dashboards, alerting, aur historical data analysis provide karta hai.

---

### **2ï¸âƒ£ Detailed Explanation with Analogy** ğŸ§ 

**Kya hai Prometheus + Grafana?**

**Prometheus:**
- Metrics collection system
- Time-series database
- Pull-based architecture (scrapes metrics)
- Powerful query language (PromQL)
- Built-in alerting

**Grafana:**
- Visualization platform
- Beautiful dashboards
- Multiple data sources support
- Alerting and notifications
- User-friendly interface

**Analogy:**
- **Prometheus** = Data collector + storage (like a weather station recording temperature)
- **Grafana** = Dashboard + graphs (like weather app showing beautiful charts)
- Together = Complete monitoring solution (NASA mission control!)

---

### **3ï¸âƒ£ Why Important?** ğŸ¯

**Admin:**
- Real-time monitoring
- Historical data analysis
- Proactive alerting
- Capacity planning
- Performance optimization
- Team collaboration

**Pentester:**
- Monitoring infrastructure discovery
- Metrics endpoints enumeration
- Sensitive data in metrics
- Network topology mapping
- Attack impact assessment

---

### **4ï¸âƒ£ Real-World Use Cases** ğŸ’¼

**Admin:**
1. Server health monitoring
2. Application performance tracking
3. Alert on high CPU/memory
4. Capacity planning with historical data
5. SLA monitoring

**Pentester:**
1. Find Prometheus endpoints (:9090)
2. Enumerate monitored servers
3. Discover internal IPs
4. Identify services
5. Metrics data analysis

---

### **5ï¸âƒ£ Installation & Setup** ğŸ“

#### **Install Prometheus:**
```bash
# Download
wget https://github.com/prometheus/prometheus/releases/download/v2.45.0/prometheus-2.45.0.linux-amd64.tar.gz
tar xvfz prometheus-*.tar.gz
cd prometheus-*

# Configure
cat > prometheus.yml << 'EOF'
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
  
  - job_name: 'node'
    static_configs:
      - targets: ['localhost:9100']
EOF

# Run
./prometheus --config.file=prometheus.yml
```

**Access:** http://localhost:9090

---

#### **Install Node Exporter:**
```bash
# Download
wget https://github.com/prometheus/node_exporter/releases/download/v1.6.0/node_exporter-1.6.0.linux-amd64.tar.gz
tar xvfz node_exporter-*.tar.gz
cd node_exporter-*

# Run
./node_exporter
```

**Metrics:** http://localhost:9100/metrics

---

#### **Install Grafana:**
```bash
# Ubuntu/Debian
sudo apt-get install -y software-properties-common
sudo add-apt-repository "deb https://packages.grafana.com/oss/deb stable main"
wget -q -O - https://packages.grafana.com/gpg.key | sudo apt-key add -
sudo apt-get update
sudo apt-get install grafana

# Start
sudo systemctl start grafana-server
sudo systemctl enable grafana-server
```

**Access:** http://localhost:3000 (admin/admin)

---

### **6ï¸âƒ£ Key Examples** ğŸ’»

#### **Example 1: PromQL Queries**

```promql
# CPU usage
100 - (avg by (instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)

# Memory usage
(node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes * 100

# Disk usage
(node_filesystem_size_bytes - node_filesystem_free_bytes) / node_filesystem_size_bytes * 100

# Network traffic
rate(node_network_receive_bytes_total[5m])
```

---

#### **Example 2: Grafana Dashboard**

**Add Data Source:**
1. Configuration â†’ Data Sources â†’ Add Prometheus
2. URL: http://localhost:9090
3. Save & Test

**Create Dashboard:**
1. Create â†’ Dashboard â†’ Add Panel
2. Query: `up`
3. Visualization: Graph
4. Save

---

#### **Example 3: Alerting**

```yaml
# prometheus.yml
alerting:
  alertmanagers:
    - static_configs:
        - targets: ['localhost:9093']

rule_files:
  - "alerts.yml"
```

**alerts.yml:**
```yaml
groups:
  - name: example
    rules:
      - alert: HighCPU
        expr: node_cpu_usage > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High CPU on {{ $labels.instance }}"
```

---

### **7ï¸âƒ£ Common Mistakes** âŒâ¡ï¸âœ…

| Mistake | Solution |
|---------|----------|
| Exposing Prometheus publicly | Use firewall/VPN |
| No authentication | Enable basic auth |
| Too many metrics | Filter unnecessary |
| No retention policy | Configure data retention |
| Ignoring alerts | Setup notifications |

---

### **8ï¸âƒ£ Best Practices** â­

**Admin:**
- âœ… Secure endpoints (firewall)
- âœ… Enable authentication
- âœ… Regular backups
- âœ… Set retention policies
- âœ… Monitor the monitoring system
- âœ… Document dashboards

**Pentester:**
- ğŸ” Check :9090, :9100, :3000 ports
- ğŸ” Enumerate /metrics endpoints
- ğŸ” Analyze exposed metrics
- ğŸ” Map infrastructure
- ğŸ” Check for credentials

---

### **9ï¸âƒ£ Real-World Scenario** ğŸŒ

**Admin - Complete Setup:**
```bash
# 1. Install Prometheus
# 2. Install Node Exporter on all servers
# 3. Configure prometheus.yml with all targets
# 4. Install Grafana
# 5. Import dashboard (ID: 1860 - Node Exporter Full)
# 6. Setup alerts
# 7. Configure email notifications
```

**Pentester - Reconnaissance:**
```bash
# Find Prometheus
nmap -p 9090,9100,3000 target-network

# Access metrics
curl http://target:9100/metrics

# Enumerate targets
curl http://target:9090/api/v1/targets

# Extract IPs and services
curl http://target:9090/api/v1/targets | jq '.data.activeTargets[].labels'
```

---

### **ğŸ”Ÿ Key Takeaways** ğŸ“Œ

**Concepts:**
1. Prometheus = Metrics + Storage
2. Grafana = Visualization
3. Node Exporter = System metrics
4. PromQL = Query language
5. Alertmanager = Notifications

**Commands:**
```bash
# Start Prometheus
./prometheus --config.file=prometheus.yml

# Start Node Exporter
./node_exporter

# Start Grafana
sudo systemctl start grafana-server
```

**Admin:**
- âœ… Modern monitoring essential
- âœ… Beautiful dashboards
- âœ… Proactive alerting
- âœ… Historical analysis
- âœ… Secure properly

**Pentester:**
- ğŸ” Check common ports
- ğŸ” Enumerate metrics
- ğŸ” Map infrastructure
- ğŸ” Analyze data
- ğŸ” Document findings

**Next Topic:** ELK Stack ğŸ“Š

---

**Happy Monitoring! ğŸ›ï¸ğŸ“Š**
